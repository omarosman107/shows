!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=a("hls.js"),e=a("./videojs5-hlsjs-source-handler.js");e(window,window.videojs,d)},{"./videojs5-hlsjs-source-handler.js":2,"hls.js":3}],2:[function(a,b,c){a("videojs-quality-picker");var d=function(a,b,c){function d(a,b){function d(){var a=b.options_.hlsjsConfig||{};j=new c(a),j.on(c.Events.ERROR,function(a,c){g(a,c,b,l)}),j.on(c.Events.MANIFEST_PARSED,h),j.on(c.Events.LEVEL_LOADED,function(a,b){m=b.details.live?1/0:b.details.totalduration}),j.attachMedia(k),k.addEventListener("waiting",i)}function e(a,b){j.nextLevel=a}function f(){1===l[c.ErrorTypes.MEDIA_ERROR]?j.recoverMediaError():2===l[c.ErrorTypes.MEDIA_ERROR]?(j.swapAudioCodec(),j.recoverMediaError()):l[c.ErrorTypes.MEDIA_ERROR]>2&&(error.code=3,b.error=function(){return error},b.trigger("error"))}function g(a,d){var e={message:"HLS.js error: "+d.type+" - fatal: "+d.fatal+" - "+d.details};if(l[d.type]?l[d.type]+=1:l[d.type]=1,d.fatal)switch(d.type){case c.ErrorTypes.NETWORK_ERROR:e.code=2,b.error=function(){return e},b.trigger("error");break;case c.ErrorTypes.MEDIA_ERROR:f();break;default:j.destroy(),b.error=function(){return e},b.trigger("error")}}function h(a,c){function d(a){return a.height?a.height+"p":a.width?Math.round(9*a.width/16)+"p":a.bitrate?a.bitrate/1e3+"kbps":0}var f=[];if(c.levels.length>1){var g={id:-1,label:"auto",selected:-1===j.manualLevel};f.push(g)}c.levels.forEach(function(a,b){var c={};c.id=b,c.selected=b===j.manualLevel,c.label=d(a),f.push(c)});var h={qualityData:{video:f},qualitySwitchCallback:e};b.trigger("loadedqualitydata",h)}function i(){j.loadSource(a.src),k.removeEventListener("waiting",i)}b.name_="streamrootHLS";var j,k=b.el(),l={},m=null;k.addEventListener("error",function(a){var b,c=a.currentTarget.error;switch(c.code){case c.MEDIA_ERR_ABORTED:b="You aborted the video playback";break;case c.MEDIA_ERR_DECODE:b="The video playback was aborted due to a corruption problem or because the video used features your browser did not support",f();break;case c.MEDIA_ERR_NETWORK:b="A network error caused the video download to fail part-way";break;case c.MEDIA_ERR_SRC_NOT_SUPPORTED:b="The video could not be loaded, either because the server or network failed or because the format is not supported"}}),this.duration=function(){return m||k.duration||0},this.dispose=function(){k.removeEventListener("waiting",i),j.destroy()},d()}c.isSupported()&&b.getComponent("Html5").registerSourceHandler({canHandleSource:function(a){var b,c=/^application\/x-mpegURL$/i,d=/\.m3u8/i;return b=c.test(a.type)?"probably":d.test(a.src)?"maybe":""},handleSource:function(a,b){return b.hlsProvider&&b.hlsProvider.dispose(),b.hlsProvider=new d(a,b),b.hlsProvider}},0),b.StreamrootProviderHLS=d};b.exports=d},{"videojs-quality-picker":7}],3:[function(a,b,c){(function(d){!function(a){if("object"==typeof c&&"undefined"!=typeof b)b.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof d?d:"undefined"!=typeof self?self:this,e.Hls=a()}}(function(){var b;return function c(b,d,e){function f(h,i){if(!d[h]){if(!b[h]){var j="function"==typeof a&&a;if(!i&&j)return j(h,!0);if(g)return g(h,!0);var k=new Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k}var l=d[h]={exports:{}};b[h][0].call(l.exports,function(a){var c=b[h][1][a];return f(c?c:a)},l,l.exports,c,b,d,e)}return d[h].exports}for(var g="function"==typeof a&&a,h=0;h<e.length;h++)f(e[h]);return f}({1:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c))for(f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length,i=0;i<d;i++)j[i].apply(this,f);return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,"function"==typeof console.trace)),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else if(c)for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],2:[function(a,c,d){!function(a){var e=/^([^#]*)(.*)$/,f=/^([^\?]*)(.*)$/,g=/^(([a-z]+:\/\/)?[^:\/]+(?::[0-9]+)?)?(\/?.*)$/i,h={buildAbsoluteURL:function(a,b){if(b=b.trim(),/^[a-z]+:/i.test(b))return b;var c=null,d=null,i=e.exec(b);i&&(d=i[2],b=i[1]);var j=f.exec(b);j&&(c=j[2],b=j[1]);var k=e.exec(a);k&&(a=k[1]);var l=f.exec(a);l&&(a=l[1]);var m=g.exec(a);if(!m)throw new Error("Error trying to parse base URL.");var n=m[2]||"",o=m[1]||"",p=m[3];0!==p.indexOf("/")&&""!==o&&(p="/"+p);var q=null;return q=/^\/\//.test(b)?n+h.buildAbsolutePath("",b.substring(2)):/^\//.test(b)?o+"/"+h.buildAbsolutePath("",b.substring(1)):h.buildAbsolutePath(o+p,b),c&&(q+=c),d&&(q+=d),q},buildAbsolutePath:function(a,b){for(var c,d,e=b,f="",g=a.replace(/[^\/]*$/,e.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),h=0;d=g.indexOf("/../",h),d>-1;h=d+c)c=/^\/(?:\.\.\/)*/.exec(g.slice(d))[0].length,f=(f+g.substring(h,d)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(c-1)/3+"}$"),"/");return f+g.substr(h)}};"object"==typeof d&&"object"==typeof c?c.exports=h:"function"==typeof b&&b.amd?b([],function(){return h}):"object"==typeof d?d.URLToolkit=h:a.URLToolkit=h}(this)},{}],3:[function(a,b,c){var d=arguments[3],e=arguments[4],f=arguments[5],g=JSON.stringify;b.exports=function(a,b){function c(a){q[a]=!0;for(var b in e[a][1]){var d=e[a][1][b];q[d]||c(d)}}for(var h,i=Object.keys(f),j=0,k=i.length;j<k;j++){var l=i[j],m=f[l].exports;if(m===a||m&&m["default"]===a){h=l;break}}if(!h){h=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var n={},j=0,k=i.length;j<k;j++){var l=i[j];n[l]=l}e[h]=[Function(["require","module","exports"],"("+a+")(self)"),n]}var o=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[h]=h,e[o]=[Function(["require"],"var f = require("+g(h)+");(f.default ? f.default : f)(self);"),p];var q={};c(o);var r="("+d+")({"+Object.keys(q).map(function(a){return g(a)+":["+e[a][0]+","+g(e[a][1])+"]"}).join(",")+"},{},["+g(o)+"])",s=window.URL||window.webkitURL||window.mozURL||window.msURL,t=new Blob([r],{type:"text/javascript"});if(b&&b.bare)return t;var u=s.createObjectURL(t),v=new Worker(u);return v.objectURL=u,v}},{}],4:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(28),j=d(i),k=a(27),l=d(k),m=a(30),n=d(m),o=a(26),p=a(45),q=a(9),r=d(q),s=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].FRAG_LOADING,j["default"].FRAG_LOADED,j["default"].FRAG_BUFFERED,j["default"].ERROR));return c.lastLoadedFragLevel=0,c._autoLevelCapping=-1,c._nextAutoLevel=-1,c.hls=a,c.onCheck=c.abandonRulesCheck.bind(c),c}return g(b,a),h(b,[{key:"destroy",value:function(){this.clearTimer(),l["default"].prototype.destroy.call(this)}},{key:"onFragLoading",value:function(a){var b=a.frag;if("main"===b.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this.bwEstimator){var c=this.hls,d=a.frag.level,e=c.levels[d].details.live,f=c.config,g=void 0,h=void 0;e?(g=f.abrEwmaFastLive,h=f.abrEwmaSlowLive):(g=f.abrEwmaFastVoD,h=f.abrEwmaSlowVoD),this.bwEstimator=new r["default"](c,h,g,f.abrEwmaDefaultEstimate)}this.fragCurrent=b}}},{key:"abandonRulesCheck",value:function(){var a=this.hls,b=a.media,c=this.fragCurrent,d=c.loader,e=this.minAutoLevel;if(!d||d.stats&&d.stats.aborted)return p.logger.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var f=d.stats;if(b&&(!b.paused&&0!==b.playbackRate||!b.readyState)&&c.autoLevel&&c.level){var g=performance.now()-f.trequest,h=Math.abs(b.playbackRate);if(g>500*c.duration/h){var i=a.levels,k=Math.max(1,f.bw?f.bw/8:1e3*f.loaded/g),l=i[c.level],m=l.realBitrate?Math.max(l.realBitrate,l.bitrate):l.bitrate,o=f.total?f.total:Math.max(f.loaded,Math.round(c.duration*m/8)),q=b.currentTime,r=(o-f.loaded)/k,s=(n["default"].bufferInfo(b,q,a.config.maxBufferHole).end-q)/h;if(s<2*c.duration/h&&r>s){var t=void 0,u=void 0;for(u=c.level-1;u>e;u--){var v=i[u].realBitrate?Math.max(i[u].realBitrate,i[u].bitrate):i[u].bitrate;if(t=c.duration*v/(6.4*k),t<s)break}t<r&&(p.logger.warn("loading too slow, abort fragment loading and switch to level "+u+":fragLoadedDelay["+u+"]<fragLoadedDelay["+(c.level-1)+"];bufferStarvationDelay:"+t.toFixed(1)+"<"+r.toFixed(1)+":"+s.toFixed(1)),a.nextLoadLevel=u,this.bwEstimator.sample(g,f.loaded),d.abort(),this.clearTimer(),a.trigger(j["default"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:c,stats:f}))}}}}},{key:"onFragLoaded",value:function(a){var b=a.frag;if("main"===b.type){this.clearTimer(),this.lastLoadedFragLevel=b.level,this._nextAutoLevel=-1;var c=this.hls.levels[b.level],d=(c.loaded?c.loaded.bytes:0)+a.stats.loaded,e=(c.loaded?c.loaded.duration:0)+a.frag.duration;if(c.loaded={bytes:d,duration:e},c.realBitrate=Math.round(8*d/e),a.frag.bitrateTest){var f=a.stats;f.tparsed=f.tbuffered=f.tload,this.onFragBuffered(a)}}}},{key:"onFragBuffered",value:function(a){var b=a.stats,c=a.frag;if(b.aborted!==!0&&1===c.loadCounter&&"main"===c.type&&(!c.bitrateTest||b.tload===b.tbuffered)){var d=b.tparsed-b.trequest;p.logger.log("latency/loading/parsing/append/kbps:"+Math.round(b.tfirst-b.trequest)+"/"+Math.round(b.tload-b.tfirst)+"/"+Math.round(b.tparsed-b.tload)+"/"+Math.round(b.tbuffered-b.tparsed)+"/"+Math.round(8*b.loaded/(b.tbuffered-b.trequest))),this.bwEstimator.sample(d,b.loaded),c.bitrateTest?this.bitrateTestDelay=d/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function(a){switch(a.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"findBestLevel",value:function(a,b,c,d,e,f,g,h,i){for(var j=e;j>=d;j--){var k=i[j],l=k.details,m=l?l.totalduration/l.fragments.length:b,n=!!l&&l.live,o=void 0;o=j<=a?g*c:h*c;var q=i[j].realBitrate?Math.max(i[j].realBitrate,i[j].bitrate):i[j].bitrate,r=q*m/o;if(p.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+j+"/"+Math.round(o)+"/"+q+"/"+m+"/"+f+"/"+r),o>q&&(!r||n||r<f))return j}return-1}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(a){this._autoLevelCapping=a}},{key:"nextAutoLevel",get:function(){var a=this._nextAutoLevel,b=this.bwEstimator,c=this.hls,d=c.levels,e=c.config.minAutoBitrate;if(!(a===-1||b&&b.canEstimate()))return Math.min(a,this.maxAutoLevel);var f=this.nextABRAutoLevel;if(a!==-1&&(f=Math.min(a,f)),void 0!==e)for(var g=d[f].realBitrate?Math.max(d[f].realBitrate,d[f].bitrate):d[f].bitrate;g<e;)f++;return f},set:function(a){this._nextAutoLevel=a}},{key:"minAutoLevel",get:function(){for(var a=this.hls,b=a.levels,c=a.config.minAutoBitrate,d=b?b.length:0,e=0;e<d;e++){var f=b[e].realBitrate?Math.max(b[e].realBitrate,b[e].bitrate):b[e].bitrate;if(f>c)return e}return 0}},{key:"maxAutoLevel",get:function(){var a,b=this.hls.levels,c=this._autoLevelCapping;return a=c===-1&&b&&b.length?b.length-1:c}},{key:"nextABRAutoLevel",get:function(){var a=this.hls,b=this.maxAutoLevel,c=a.levels,d=a.config,e=this.minAutoLevel,f=a.media,g=this.lastLoadedFragLevel,h=this.fragCurrent?this.fragCurrent.duration:0,i=f?f.currentTime:0,j=f&&0!==f.playbackRate?Math.abs(f.playbackRate):1,k=this.bwEstimator?this.bwEstimator.getEstimate():d.abrEwmaDefaultEstimate,l=(n["default"].bufferInfo(f,i,d.maxBufferHole).end-i)/j,m=this.findBestLevel(g,h,k,e,b,l,d.abrBandWidthFactor,d.abrBandWidthUpFactor,c);if(m>=0)return m;p.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var o=h?Math.min(h,d.maxStarvationDelay):d.maxStarvationDelay,q=d.abrBandWidthFactor,r=d.abrBandWidthUpFactor;if(0===l){var s=this.bitrateTestDelay;if(s){var t=h?Math.min(h,d.maxLoadingDelay):d.maxLoadingDelay;o=t-s,p.logger.trace("bitrate test took "+Math.round(1e3*s)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*o)+" ms"),q=r=1}}return m=this.findBestLevel(g,h,k,e,b,l+o,q,r,c),Math.max(m,0)}}]),b}(l["default"]);c["default"]=s},{26:26,27:27,28:28,30:30,45:45,9:9}],5:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=a(41),k=d(j),l=a(30),m=d(l),n=a(22),o=d(n),p=a(28),q=d(p),r=a(27),s=d(r),t=a(31),u=d(t),v=a(46),w=d(v),x=a(26),y=a(45),z={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},A=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,q["default"].MEDIA_ATTACHED,q["default"].MEDIA_DETACHING,q["default"].AUDIO_TRACKS_UPDATED,q["default"].AUDIO_TRACK_SWITCHING,q["default"].AUDIO_TRACK_LOADED,q["default"].KEY_LOADED,q["default"].FRAG_LOADED,q["default"].FRAG_PARSING_INIT_SEGMENT,q["default"].FRAG_PARSING_DATA,q["default"].FRAG_PARSED,q["default"].ERROR,q["default"].BUFFER_CREATED,q["default"].BUFFER_APPENDED,q["default"].BUFFER_FLUSHED,q["default"].INIT_PTS_FOUND));return c.config=a.config,c.audioCodecSwap=!1,c.ticks=0,c._state=z.STOPPED,c.ontick=c.tick.bind(c),c.initPTS=[],c.waitingFragment=null,c}return g(b,a),i(b,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),s["default"].prototype.destroy.call(this),this.state=z.STOPPED}},{key:"onInitPtsFound",value:function(a){var b=a.id,c=a.cc,d=a.initPTS;"main"===b&&(this.initPTS[c]=d,y.logger.log("InitPTS for cc:"+c+" found from video track:"+d),this.state===z.WAITING_INIT_PTS&&(y.logger.log("sending pending audio frag to demuxer"),this.state=z.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))}},{key:"startLoad",value:function(a){if(this.tracks){var b=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,b>0&&a===-1?(y.logger.log("audio:override startPosition with lastCurrentTime @"+b.toFixed(3)),this.state=z.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:a,this.state=z.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=a,this.state=z.STOPPED}},{key:"stopLoad",value:function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=z.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var a,b,c,d,e,f,g=this,i=this.hls,j=i.config,l=function(){switch(g.state){case z.ERROR:case z.PAUSED:case z.BUFFER_FLUSHING:break;case z.STARTING:g.state=z.WAITING_TRACK,g.loadedmetadata=!1;break;case z.IDLE:var h=g.tracks;if(!h)break;if(!g.media&&(g.startFragRequested||!j.startFragPrefetch))break;a=g.loadedmetadata?g.media.currentTime:g.nextLoadPosition;var l=g.mediaBuffer?g.mediaBuffer:g.media,n=m["default"].bufferInfo(l,a,j.maxBufferHole),o=n.len,p=n.end,r=g.fragPrevious,s=j.maxMaxBufferLength,t=g.audioSwitch,u=g.trackId;if(o<s&&u<h.length){if(c=h[u].details,"undefined"==typeof c){g.state=z.WAITING_TRACK;break}if(!t&&!c.live&&r&&r.sn===c.endSN&&(!g.media.seeking||g.media.duration-p<r.duration/2)){g.hls.trigger(q["default"].BUFFER_EOS,{type:"audio"}),g.state=z.ENDED;break}var v=c.fragments,w=v.length,A=v[0].start,B=v[w-1].start+v[w-1].duration,C=void 0;if(t)if(c.live&&!c.PTSKnown)y.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),p=0;else if(p=a,c.PTSKnown&&a<A){if(!(n.end>A||n.nextStart))return{v:void 0};y.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),g.media.currentTime=A+.05}if(p<=A){if(C=v[0],c.live&&C.loadIdx&&C.loadIdx===g.fragLoadIdx){var D=n.nextStart?n.nextStart:A;return y.logger.log("no alt audio available @currentTime:"+g.media.currentTime+", seeking @"+(D+.05)),g.media.currentTime=D+.05,{v:void 0}}}else!function(){var a=void 0,b=j.maxFragLookUpTolerance;p<B?(p>B-b&&(b=0),a=k["default"].search(v,function(a){return a.start+a.duration-b<=p?1:a.start-b>p?-1:0}),a||y.logger.log("frag not found @bufferEnd/start:"+p+"/"+A)):a=v[w-1],a&&(C=a,A=a.start,r&&C.level===r.level&&C.sn===r.sn&&(C.sn<c.endSN?(C=v[C.sn+1-c.startSN],y.logger.log("SN just loaded, load next one: "+C.sn)):C=null))}();if(C)if(null!=C.decryptdata.uri&&null==C.decryptdata.key)y.logger.log("Loading key for "+C.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+u),g.state=z.KEY_LOADING,i.trigger(q["default"].KEY_LOADING,{frag:C});else{if(y.logger.log("Loading "+C.sn+" of ["+c.startSN+" ,"+c.endSN+"],track "+u+", currentTime:"+a+",bufferEnd:"+p.toFixed(3)),void 0!==g.fragLoadIdx?g.fragLoadIdx++:g.fragLoadIdx=0,C.loadCounter){C.loadCounter++;var E=j.fragLoadingLoopThreshold;if(C.loadCounter>E&&Math.abs(g.fragLoadIdx-C.loadIdx)<E)return i.trigger(q["default"].ERROR,{type:x.ErrorTypes.MEDIA_ERROR,details:x.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:C}),{v:void 0}}else C.loadCounter=1;C.loadIdx=g.fragLoadIdx,g.fragCurrent=C,g.startFragRequested=!0,g.nextLoadPosition=C.start+C.duration,i.trigger(q["default"].FRAG_LOADING,{frag:C}),g.state=z.FRAG_LOADING}}break;case z.WAITING_TRACK:b=g.tracks[g.trackId],b&&b.details&&(g.state=z.IDLE);break;case z.FRAG_LOADING_WAITING_RETRY:d=performance.now(),e=g.retryDate,l=g.media,f=l&&l.seeking,(!e||d>=e||f)&&(y.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),g.state=z.IDLE);break;case z.WAITING_INIT_PTS:case z.STOPPED:case z.FRAG_LOADING:case z.PARSING:case z.PARSED:case z.ENDED:}}();if("object"===("undefined"==typeof l?"undefined":h(l)))return l.v}},{key:"onMediaAttached",value:function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("ended",this.onvended);var c=this.config;this.tracks&&c.autoStartLoad&&this.startLoad(c.startPosition)}},{key:"onMediaDetaching",value:function(){var a=this.media;a&&a.ended&&(y.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.tracks;b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.loadCounter=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){this.state===z.ENDED&&(this.state=z.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaEnded",value:function(){this.startPosition=this.lastCurrentTime=0}},{key:"onAudioTracksUpdated",value:function(a){y.logger.log("audio tracks updated"),this.tracks=a.audioTracks}},{key:"onAudioTrackSwitching",value:function(a){var b=!!a.url;this.trackId=a.id,this.state=z.IDLE,this.fragCurrent=null,this.state=z.PAUSED,this.waitingFragment=null,b?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),b&&(this.audioSwitch=!0,this.state=z.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()}},{key:"onAudioTrackLoaded",value:function(a){var b=a.details,c=a.id,d=this.tracks[c],e=b.totalduration,f=0;if(y.logger.log("track "+c+" loaded ["+b.startSN+","+b.endSN+"],duration:"+e),b.live){var g=d.details;g&&b.fragments.length>0?(u["default"].mergeDetails(g,b),f=b.fragments[0].start,b.PTSKnown?y.logger.log("live audio playlist sliding:"+f.toFixed(3)):y.logger.log("live audio playlist - outdated PTS, unknown sliding")):(b.PTSKnown=!1,y.logger.log("live audio playlist - first load, unknown sliding"))}else b.PTSKnown=!1;if(d.details=b,!this.startFragRequested){if(this.startPosition===-1){var h=b.startTimeOffset;isNaN(h)?this.startPosition=0:(y.logger.log("start time offset found in playlist, adjust startPosition to "+h),this.startPosition=h)}this.nextLoadPosition=this.startPosition}this.state===z.WAITING_TRACK&&(this.state=z.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===z.KEY_LOADING&&(this.state=z.IDLE,this.tick())}},{key:"onFragLoaded",value:function(a){var b=this.fragCurrent;if(this.state===z.FRAG_LOADING&&b&&"audio"===a.frag.type&&a.frag.level===b.level&&a.frag.sn===b.sn){this.state=z.PARSING,this.stats=a.stats;var c=this.tracks[this.trackId],d=c.details,e=d.totalduration,f=b.start,g=b.level,h=b.sn,i=b.cc,j=this.config.defaultAudioCodec||c.audioCodec;this.appended=!1,this.demuxer||(this.demuxer=new o["default"](this.hls,"audio"));var k=this.initPTS[i];if(void 0!==k){this.pendingBuffering=!0,y.logger.log("Demuxing "+h+" of ["+d.startSN+" ,"+d.endSN+"],track "+g);var l=!1;this.demuxer.push(a.payload,j,null,f,i,g,h,e,b.decryptdata,l,k)}else y.logger.log("unknown video PTS for continuity counter "+i+", waiting for video PTS before demuxing audio frag "+h+" of ["+d.startSN+" ,"+d.endSN+"],track "+g),this.waitingFragment=a,this.state=z.WAITING_INIT_PTS}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(a){var b=this.fragCurrent;if(b&&"audio"===a.id&&a.sn===b.sn&&a.level===b.level&&this.state===z.PARSING){var c=a.tracks,d=void 0;if(c.video&&delete c.video,d=c.audio){d.levelCodec="mp4a.40.2",d.id=a.id,this.hls.trigger(q["default"].BUFFER_CODECS,c),y.logger.log("audio track:audio,container:"+d.container+",codecs[level/parsed]=["+d.levelCodec+"/"+d.codec+"]");var e=d.initSegment;if(e){var f={type:"audio",data:e,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[f]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(q["default"].BUFFER_APPENDING,f))}this.tick()}}}},{key:"onFragParsingData",value:function(a){var b=this,c=this.fragCurrent;c&&"audio"===a.id&&"audio"===a.type&&a.sn===c.sn&&a.level===c.level&&this.state===z.PARSING&&!function(){var c=b.trackId,d=b.tracks[c],e=b.fragCurrent,f=b.hls;y.logger.log("parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb),u["default"].updateFragPTSDTS(d.details,e.sn,a.startPTS,a.endPTS);var g=b.audioSwitch,h=b.media,i=!1;if(g&&h)if(h.readyState){var j=h.currentTime;y.logger.log("switching audio track : currentTime:"+j),j>=a.startPTS&&(y.logger.log("switching audio track : flushing all audio"),b.state=z.BUFFER_FLUSHING,f.trigger(q["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),i=!0,b.audioSwitch=!1,f.trigger(q["default"].AUDIO_TRACK_SWITCHED,{id:c}))}else b.audioSwitch=!1,f.trigger(q["default"].AUDIO_TRACK_SWITCHED,{id:c});var k=b.pendingData;b.audioSwitch||([a.data1,a.data2].forEach(function(b){b&&k.push({type:a.type,data:b,parent:"audio",content:"data"})}),!i&&k.length&&(k.forEach(function(a){b.pendingBuffering=!0,b.hls.trigger(q["default"].BUFFER_APPENDING,a)}),b.pendingData=[],b.appended=!0)),b.tick()}()}},{key:"onFragParsed",value:function(a){var b=this.fragCurrent;b&&"audio"===a.id&&a.sn===b.sn&&a.level===b.level&&this.state===z.PARSING&&(this.stats.tparsed=performance.now(),this.state=z.PARSED,this._checkAppendedParsed())}},{key:"onBufferCreated",value:function(a){var b=a.tracks.audio;b&&(this.mediaBuffer=b.buffer,this.loadedmetadata=!0)}},{key:"onBufferAppended",value:function(a){if("audio"===a.parent){var b=this.state;b!==z.PARSING&&b!==z.PARSED||(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){if(!(this.state!==z.PARSED||this.appended&&this.pendingBuffering)){var a=this.fragCurrent,b=this.stats,c=this.hls;if(a){this.fragPrevious=a,b.tbuffered=performance.now(),c.trigger(q["default"].FRAG_BUFFERED,{stats:b,frag:a,id:"audio"});var d=this.mediaBuffer?this.mediaBuffer:this.media;y.logger.log("audio buffered : "+w["default"].toString(d.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,c.trigger(q["default"].AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=z.IDLE}this.tick()}}},{key:"onError",value:function(a){var b=a.frag;if(!b||"audio"===b.type)switch(a.details){case x.ErrorDetails.FRAG_LOAD_ERROR:case x.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!a.fatal){var c=this.fragLoadError;c?c++:c=1;var d=this.config;if(c<=d.fragLoadingMaxRetry){this.fragLoadError=c,b.loadCounter=0;var e=Math.min(Math.pow(2,c-1)*d.fragLoadingRetryDelay,d.fragLoadingMaxRetryTimeout);y.logger.warn("audioStreamController: frag loading failed, retry in "+e+" ms"),this.retryDate=performance.now()+e,this.state=z.FRAG_LOADING_WAITING_RETRY}else y.logger.error("audioStreamController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.hls.trigger(q["default"].ERROR,a),this.state=z.ERROR}break;case x.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case x.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case x.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case x.ErrorDetails.KEY_LOAD_ERROR:case x.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==z.ERROR&&(this.state=a.fatal?z.ERROR:z.IDLE,y.logger.warn("audioStreamController: "+a.details+" while loading frag,switch to "+this.state+" state ..."))}}},{key:"onBufferFlushed",value:function(){var a=this,b=this.pendingData;b&&b.length?(y.logger.log("appending pending audio data on Buffer Flushed"),b.forEach(function(b){a.hls.trigger(q["default"].BUFFER_APPENDING,b)}),this.appended=!0,this.pendingData=[],this.state=z.PARSED):(this.state=z.IDLE,this.fragPrevious=null,this.tick())}},{key:"state",set:function(a){if(this.state!==a){var b=this.state;this._state=a,y.logger.log("audio stream:"+b+"->"+a)}},get:function(){return this._state}}]),b}(s["default"]);c["default"]=A},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],6:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d);
}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(28),j=d(i),k=a(27),l=d(k),m=a(45),n=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].MANIFEST_LOADING,j["default"].MANIFEST_LOADED,j["default"].AUDIO_TRACK_LOADED));return c.ticks=0,c.ontick=c.tick.bind(c),c}return g(b,a),h(b,[{key:"destroy",value:function(){l["default"].prototype.destroy.call(this)}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){this.updateTrack(this.trackId)}},{key:"onManifestLoading",value:function(){this.tracks=[],this.trackId=-1}},{key:"onManifestLoaded",value:function(a){var b=this,c=a.audioTracks||[],d=!1;this.tracks=c,this.hls.trigger(j["default"].AUDIO_TRACKS_UPDATED,{audioTracks:c});var e=0;c.forEach(function(a){return a["default"]?(b.audioTrack=e,void(d=!0)):void e++}),d===!1&&c.length&&(m.logger.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)}},{key:"onAudioTrackLoaded",value:function(a){a.id<this.tracks.length&&(m.logger.log("audioTrack "+a.id+" loaded"),this.tracks[a.id].details=a.details,a.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*a.details.targetduration)),!a.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))}},{key:"setAudioTrackInternal",value:function(a){if(a>=0&&a<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=a,m.logger.log("switching to audioTrack "+a);var b=this.tracks[a],c=this.hls,d=b.type,e=b.url,f={id:a,type:d,url:e};c.trigger(j["default"].AUDIO_TRACK_SWITCH,f),c.trigger(j["default"].AUDIO_TRACK_SWITCHING,f);var g=b.details;!e||void 0!==g&&g.live!==!0||(m.logger.log("(re)loading playlist for audioTrack "+a),c.trigger(j["default"].AUDIO_TRACK_LOADING,{url:e,id:a}))}}},{key:"updateTrack",value:function(a){if(a>=0&&a<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=a,m.logger.log("updating audioTrack "+a);var b=this.tracks[a],c=b.url,d=b.details;!c||void 0!==d&&d.live!==!0||(m.logger.log("(re)loading playlist for audioTrack "+a),this.hls.trigger(j["default"].AUDIO_TRACK_LOADING,{url:c,id:a}))}}},{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(a){this.trackId===a&&void 0!==this.tracks[a].details||this.setAudioTrackInternal(a)}}]),b}(l["default"]);c["default"]=n},{27:27,28:28,45:45}],7:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(28),j=d(i),k=a(27),l=d(k),m=a(45),n=a(26),o=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].MEDIA_ATTACHING,j["default"].MEDIA_DETACHING,j["default"].MANIFEST_PARSED,j["default"].BUFFER_RESET,j["default"].BUFFER_APPENDING,j["default"].BUFFER_CODECS,j["default"].BUFFER_EOS,j["default"].BUFFER_FLUSHING,j["default"].LEVEL_PTS_UPDATED,j["default"].LEVEL_UPDATED));return c._msDuration=null,c._levelDuration=null,c.onsbue=c.onSBUpdateEnd.bind(c),c.onsbe=c.onSBUpdateError.bind(c),c.pendingTracks={},c.tracks={},c}return g(b,a),h(b,[{key:"destroy",value:function(){l["default"].prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function(a){var b=a.type,c=this.tracks.audio;if("audio"===b&&c&&"audio/mpeg"===c.container){var d=this.sourceBuffer.audio,e=Math.abs(d.timestampOffset-a.start);if(e>.1){var f=d.updating;try{d.abort()}catch(g){f=!0,m.logger.warn("can not abort audio buffer: "+g)}f?this.audioTimestampOffset=a.start:(m.logger.warn("change mpeg audio timestamp offset from "+d.timestampOffset+" to "+a.start),d.timestampOffset=a.start)}}}},{key:"onManifestParsed",value:function(a){var b=a.audio,c=a.video,d=0;a.altAudio&&(b||c)&&(d=(b?1:0)+(c?1:0),m.logger.log(d+" sourceBuffer(s) expected")),this.sourceBufferNb=d}},{key:"onMediaAttaching",value:function(a){var b=this.media=a.media;if(b){var c=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),c.addEventListener("sourceopen",this.onmso),c.addEventListener("sourceended",this.onmse),c.addEventListener("sourceclose",this.onmsc),b.src=URL.createObjectURL(c)}}},{key:"onMediaDetaching",value:function(){m.logger.log("media source detaching");var a=this.mediaSource;if(a){if("open"===a.readyState)try{a.endOfStream()}catch(b){m.logger.warn("onMediaDetaching:"+b.message+" while calling endOfStream")}a.removeEventListener("sourceopen",this.onmso),a.removeEventListener("sourceended",this.onmse),a.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(j["default"].MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){m.logger.log("media source opened"),this.hls.trigger(j["default"].MEDIA_ATTACHED,{media:this.media});var a=this.mediaSource;a&&a.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function(){var a=this.pendingTracks,b=Object.keys(a).length;b&&(this.sourceBufferNb<=b||0===this.sourceBufferNb)&&(this.createSourceBuffers(a),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function(){m.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){m.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){if(this.audioTimestampOffset){var a=this.sourceBuffer.audio;m.logger.warn("change mpeg audio timestamp offset from "+a.timestampOffset+" to "+this.audioTimestampOffset),a.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var b=this.parent,c=this.segments.reduce(function(a,c){return c.parent===b?a+1:a},0);this.hls.trigger(j["default"].BUFFER_APPENDED,{parent:b,pending:c}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function(a){m.logger.error("sourceBuffer error:"+a),this.hls.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var a=this.sourceBuffer;for(var b in a){var c=a[b];try{this.mediaSource.removeSourceBuffer(c),c.removeEventListener("updateend",this.onsbue),c.removeEventListener("error",this.onsbe)}catch(d){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function(a){if(0===Object.keys(this.sourceBuffer).length){for(var b in a)this.pendingTracks[b]=a[b];var c=this.mediaSource;c&&"open"===c.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function(a){var b=this.sourceBuffer,c=this.mediaSource;for(var d in a)if(!b[d]){var e=a[d],f=e.levelCodec||e.codec,g=e.container+";codecs="+f;m.logger.log("creating sourceBuffer("+g+")");try{var h=b[d]=c.addSourceBuffer(g);h.addEventListener("updateend",this.onsbue),h.addEventListener("error",this.onsbe),this.tracks[d]={codec:f,container:e.container},e.buffer=h}catch(i){m.logger.error("error while trying to add sourceBuffer:"+i.message),this.hls.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:i,mimeType:g})}}this.hls.trigger(j["default"].BUFFER_CREATED,{tracks:a})}},{key:"onBufferAppending",value:function(a){this._needsFlush||(this.segments?this.segments.push(a):this.segments=[a],this.doAppending())}},{key:"onBufferAppendFail",value:function(a){m.logger.error("sourceBuffer error:",a.event),this.hls.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1,frag:this.fragCurrent})}},{key:"onBufferEos",value:function(a){var b=this.sourceBuffer,c=a.type;for(var d in b)c&&d!==c||b[d].ended||(b[d].ended=!0,m.logger.log(d+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function(){var a=this.sourceBuffer,b=this.mediaSource;if(!b||"open"!==b.readyState)return void(this._needsEos=!1);for(var c in a){var d=a[c];if(!d.ended)return;if(d.updating)return void(this._needsEos=!0)}m.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{b.endOfStream()}catch(e){m.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function(a){this.flushRange.push({start:a.startOffset,end:a.endOffset,type:a.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function(a){var b=a.details;0!==b.fragments.length&&(this._levelDuration=b.totalduration+b.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function(){var a=this.media,b=this.mediaSource,c=this.sourceBuffer,d=this._levelDuration;if(null!==d&&a&&b&&c&&0!==a.readyState&&"open"===b.readyState){for(var e in c)if(c[e].updating)return;null===this._msDuration&&(this._msDuration=b.duration);var f=a.duration;(d>this._msDuration&&d>f||f===1/0||isNaN(f))&&(m.logger.log("Updating mediasource duration to "+d.toFixed(3)),this._msDuration=b.duration=d)}}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var a=this.flushRange[0];if(!this.flushBuffer(a.start,a.end,a.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var b=0,c=this.sourceBuffer;try{for(var d in c)b+=c[d].buffered.length}catch(e){m.logger.error("error while accessing sourceBuffer.buffered")}this.appended=b,this.hls.trigger(j["default"].BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var a=this.hls,b=this.sourceBuffer,c=this.segments;if(Object.keys(b).length){if(this.media.error)return this.segments=[],void m.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(c&&c.length){var d=c.shift();try{var e=d.type,f=b[e];f?f.updating?c.unshift(d):(f.ended=!1,this.parent=d.parent,f.appendBuffer(d.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(g){m.logger.error("error while trying to append buffer:"+g.message),c.unshift(d);var h={type:n.ErrorTypes.MEDIA_ERROR};if(22===g.code)return this.segments=[],h.details=n.ErrorDetails.BUFFER_FULL_ERROR,h.fatal=!1,void a.trigger(j["default"].ERROR,h);if(this.appendError?this.appendError++:this.appendError=1,h.details=n.ErrorDetails.BUFFER_APPEND_ERROR,h.frag=this.fragCurrent,this.appendError>a.config.appendErrorMaxRetry)return m.logger.log("fail "+a.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),c=[],h.fatal=!0,void a.trigger(j["default"].ERROR,h);h.fatal=!1,a.trigger(j["default"].ERROR,h)}}}}},{key:"flushBuffer",value:function(a,b,c){var d,e,f,g,h,i,j=this.sourceBuffer;if(Object.keys(j).length){if(m.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+a+"/"+b),this.flushBufferCounter<this.appended){for(var k in j)if(!c||k===c){if(d=j[k],d.ended=!1,d.updating)return m.logger.warn("cannot flush, sb updating in progress"),!1;try{for(e=0;e<d.buffered.length;e++)if(f=d.buffered.start(e),g=d.buffered.end(e),navigator.userAgent.toLowerCase().indexOf("firefox")!==-1&&b===Number.POSITIVE_INFINITY?(h=a,i=b):(h=Math.max(f,a),i=Math.min(g,b)),Math.min(i,g)-h>.5)return this.flushBufferCounter++,m.logger.log("flush "+k+" ["+h+","+i+"], of ["+f+","+g+"], pos:"+this.media.currentTime),d.remove(h,i),!1}catch(l){m.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else m.logger.warn("abort flushing too many retries");m.logger.log("buffer flushed")}return!0}}]),b}(l["default"]);c["default"]=o},{26:26,27:27,28:28,45:45}],8:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(28),j=d(i),k=a(27),l=d(k),m=function(a){function b(a){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].FPS_DROP_LEVEL_CAPPING,j["default"].MEDIA_ATTACHING,j["default"].MANIFEST_PARSED))}return g(b,a),h(b,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function(a){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(a.droppedLevel)||this.restrictedLevels.push(a.droppedLevel)}},{key:"onMediaAttaching",value:function(a){this.media=a.media instanceof HTMLVideoElement?a.media:null}},{key:"onManifestParsed",value:function(a){var b=this.hls;b.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=a.levels,b.firstLevel=this.getMaxLevel(a.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var a=this.levels?this.levels.length:0;if(a){var b=this.hls;b.autoLevelCapping=this.getMaxLevel(a-1),b.autoLevelCapping>this.autoLevelCapping&&b.streamController.nextLevelSwitch(),this.autoLevelCapping=b.autoLevelCapping}}}},{key:"getMaxLevel",value:function(a){var b=0,c=void 0,d=void 0,e=this.mediaWidth,f=this.mediaHeight,g=0,h=0;for(c=0;c<=a&&(d=this.levels[c],!this.isLevelRestricted(c))&&(b=c,g=d.width,h=d.height,!(e<=g||f<=h));c++);return b}},{key:"isLevelRestricted",value:function(a){return!(!this.restrictedLevels||this.restrictedLevels.indexOf(a)===-1)}},{key:"contentScaleFactor",get:function(){var a=1;try{a=window.devicePixelRatio}catch(b){}return a}},{key:"mediaWidth",get:function(){var a=void 0,b=this.media;return b&&(a=b.width||b.clientWidth||b.offsetWidth,a*=this.contentScaleFactor),a}},{key:"mediaHeight",get:function(){var a=void 0,b=this.media;return b&&(a=b.height||b.clientHeight||b.offsetHeight,a*=this.contentScaleFactor),a}}]),b}(l["default"]);c["default"]=m},{27:27,28:28}],9:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(44),h=d(g),i=function(){function a(b,c,d,f){e(this,a),this.hls=b,this.defaultEstimate_=f,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new h["default"](c),this.fast_=new h["default"](d)}return f(a,[{key:"sample",value:function(a,b){a=Math.max(a,this.minDelayMs_);var c=8e3*b/a,d=a/1e3;this.fast_.sample(d,c),this.slow_.sample(d,c)}},{key:"canEstimate",value:function(){var a=this.fast_;return a&&a.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function(){}}]),a}();c["default"]=i},{44:44}],10:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(28),j=d(i),k=a(27),l=d(k),m=a(45),n=function(a){function b(a){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].MEDIA_ATTACHING))}return g(b,a),h(b,[{key:"destroy",value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function(a){var b=this.hls.config;if(b.capLevelOnFPSDrop){var c=this.video=a.media instanceof HTMLVideoElement?a.media:null;"function"==typeof c.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),b.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function(a,b,c){var d=performance.now();if(b){if(this.lastTime){var e=d-this.lastTime,f=c-this.lastDroppedFrames,g=b-this.lastDecodedFrames,h=1e3*f/e,i=this.hls;if(i.trigger(j["default"].FPS_DROP,{currentDropped:f,currentDecoded:g,totalDroppedFrames:c}),h>0&&f>i.config.fpsDroppedMonitoringThreshold*g){var k=i.currentLevel;m.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+k),k>0&&(i.autoLevelCapping===-1||i.autoLevelCapping>=k)&&(k-=1,i.trigger(j["default"].FPS_DROP_LEVEL_CAPPING,{level:k,droppedLevel:i.currentLevel}),i.autoLevelCapping=k,i.streamController.nextLevelSwitch())}}this.lastTime=d,this.lastDroppedFrames=c,this.lastDecodedFrames=b}}},{key:"checkFPSInterval",value:function(){var a=this.video;if(a)if(this.isVideoPlaybackQualityAvailable){var b=a.getVideoPlaybackQuality();this.checkFPS(a,b.totalVideoFrames,b.droppedVideoFrames)}else this.checkFPS(a,a.webkitDecodedFrameCount,a.webkitDroppedFrameCount)}}]),b}(l["default"]);c["default"]=n},{27:27,28:28,45:45}],11:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(28),j=d(i),k=a(27),l=d(k),m=a(45),n=a(26),o=a(30),p=d(o),q=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].MANIFEST_LOADED,j["default"].LEVEL_LOADED,j["default"].FRAG_LOADED,j["default"].ERROR));return c.ontick=c.tick.bind(c),c._manualLevel=c._autoLevelCapping=-1,c}return g(b,a),h(b,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0;var a=this._levels;a&&a.forEach(function(a){a.loadError=0;var b=a.details;b&&b.live&&(a.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(a){var b,c=[],d=[],e={},f=!1,g=!1,h=this.hls,i=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),k=function(a,b){return MediaSource.isTypeSupported(a+"/mp4;codecs="+b)};if(a.levels.forEach(function(a){a.videoCodec&&(f=!0),i&&a.audioCodec&&a.audioCodec.indexOf("mp4a.40.34")!==-1&&(a.audioCodec=void 0),(a.audioCodec||a.attrs&&a.attrs.AUDIO)&&(g=!0);var b=e[a.bitrate];void 0===b?(e[a.bitrate]=c.length,a.url=[a.url],a.urlId=0,c.push(a)):c[b].url.push(a.url)}),f&&g?c.forEach(function(a){a.videoCodec&&d.push(a)}):d=c,d=d.filter(function(a){var b=a.audioCodec,c=a.videoCodec;return(!b||k("audio",b))&&(!c||k("video",c))}),d.length){b=d[0].bitrate,d.sort(function(a,b){return a.bitrate-b.bitrate}),this._levels=d;for(var l=0;l<d.length;l++)if(d[l].bitrate===b){this._firstLevel=l,m.logger.log("manifest loaded,"+d.length+" level(s) found, first bitrate:"+b);break}h.trigger(j["default"].MANIFEST_PARSED,{levels:d,firstLevel:this._firstLevel,stats:a.stats,audio:g,video:f,altAudio:a.audioTracks.length>0})}else h.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:h.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(a){var b=this._levels;if(a>=0&&a<b.length){this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==a&&(m.logger.log("switching to level "+a),this._level=a,this.hls.trigger(j["default"].LEVEL_SWITCH,{level:a}));var c=b[a],d=c.details;if(!d||d.live===!0){var e=c.urlId;this.hls.trigger(j["default"].LEVEL_LOADING,{url:c.url[e],level:a,id:e})}}else this.hls.trigger(j["default"].ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.LEVEL_SWITCH_ERROR,level:a,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(a){if(!a.fatal){var b=a.details,c=this.hls,d=void 0,e=void 0,f=!1,g=c.abrController,h=g.minAutoLevel;switch(b){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:case n.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case n.ErrorDetails.KEY_LOAD_ERROR:case n.ErrorDetails.KEY_LOAD_TIMEOUT:d=a.frag.level;break;case n.ErrorDetails.LEVEL_LOAD_ERROR:case n.ErrorDetails.LEVEL_LOAD_TIMEOUT:d=a.context.level,f=!0;break;case n.ErrorDetails.REMUX_ALLOC_ERROR:d=a.level}if(void 0!==d){e=this._levels[d],e.loadError?e.loadError++:e.loadError=1;var i=e.url.length;if(i>1&&e.loadError<i)e.urlId=(e.urlId+1)%i,e.details=void 0,m.logger.warn("level controller,"+b+" for level "+d+": switching to redundant stream id "+e.urlId);else{var k=this._manualLevel===-1&&d;if(k)m.logger.warn("level controller,"+b+": switch-down for next fragment"),g.nextAutoLevel=Math.max(h,d-1);else if(e&&e.details&&e.details.live)m.logger.warn("level controller,"+b+" on live stream, discard"),f&&(this._level=void 0);else if(b===n.ErrorDetails.LEVEL_LOAD_ERROR||b===n.ErrorDetails.LEVEL_LOAD_TIMEOUT){var l=c.media,o=l&&p["default"].isBuffered(l,l.currentTime)&&p["default"].isBuffered(l,l.currentTime+.5);if(o){var q=c.config.levelLoadingRetryDelay;m.logger.warn("level controller,"+b+", but media buffered, retry in "+q+"ms"),this.timer=setTimeout(this.ontick,q)}else m.logger.error("cannot recover "+b+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),a.fatal=!0,c.trigger(j["default"].ERROR,a)}}}}}},{key:"onFragLoaded",value:function(a){var b=a.frag;if(b&&"main"===b.type){var c=this._levels[b.level];c&&(c.loadError=0)}}},{key:"onLevelLoaded",value:function(a){var b=a.level;if(b===this._level){var c=this._levels[b];c.loadError=0;var d=a.details;if(d.live){var e=1e3*(d.averagetargetduration?d.averagetargetduration:d.targetduration),f=c.details;f&&d.endSN===f.endSN&&(e/=2,m.logger.log("same live playlist, reload twice faster")),e-=performance.now()-a.stats.trequest,e=Math.max(1e3,Math.round(e)),m.logger.log("live playlist, reload in "+e+" ms"),this.timer=setTimeout(this.ontick,e)}else this.timer=null}}},{key:"tick",value:function(){var a=this._level;if(void 0!==a&&this.canload){var b=this._levels[a],c=b.urlId;this.hls.trigger(j["default"].LEVEL_LOADING,{url:b.url[c],level:a,id:c})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(a){var b=this._levels;b&&b.length>a&&(this._level===a&&void 0!==b[a].details||this.setLevelInternal(a))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(a){this._manualLevel=a,void 0===this._startLevel&&(this._startLevel=a),a!==-1&&(this.level=a)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(a){this._firstLevel=a}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var a=this.hls.config.startLevel;return void 0!==a?a:this._firstLevel}return this._startLevel},set:function(a){a!==-1&&(a=Math.max(a,this.hls.abrController.minAutoLevel)),this._startLevel=a}},{key:"nextLoadLevel",get:function(){return this._manualLevel!==-1?this._manualLevel:this.hls.abrController.nextAutoLevel},set:function(a){this.level=a,this._manualLevel===-1&&(this.hls.abrController.nextAutoLevel=a)}}]),b}(l["default"]);c["default"]=q},{26:26,27:27,28:28,30:30,45:45}],12:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(41),j=d(i),k=a(30),l=d(k),m=a(22),n=d(m),o=a(28),p=d(o),q=a(27),r=d(q),s=a(31),t=d(s),u=a(46),v=d(u),w=a(26),x=a(45),y={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},z=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,p["default"].MEDIA_ATTACHED,p["default"].MEDIA_DETACHING,p["default"].MANIFEST_LOADING,p["default"].MANIFEST_PARSED,p["default"].LEVEL_LOADED,p["default"].KEY_LOADED,p["default"].FRAG_LOADED,p["default"].FRAG_LOAD_EMERGENCY_ABORTED,p["default"].FRAG_PARSING_INIT_SEGMENT,p["default"].FRAG_PARSING_DATA,p["default"].FRAG_PARSED,p["default"].ERROR,p["default"].AUDIO_TRACK_SWITCHING,p["default"].AUDIO_TRACK_SWITCHED,p["default"].BUFFER_CREATED,p["default"].BUFFER_APPENDED,p["default"].BUFFER_FLUSHED));return c.config=a.config,c.audioCodecSwap=!1,c.ticks=0,c._state=y.STOPPED,c.ontick=c.tick.bind(c),c}return g(b,a),h(b,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),r["default"].prototype.destroy.call(this),this.state=y.STOPPED}},{key:"startLoad",value:function(a){if(this.levels){var b=this.lastCurrentTime,c=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var d=c.startLevel;d===-1&&(d=0,this.bitrateTest=!0),this.level=c.nextLoadLevel=d,this.loadedmetadata=!1}b>0&&a===-1&&(x.logger.log("override startPosition with lastCurrentTime @"+b.toFixed(3)),a=b),this.state=y.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()}else x.logger.warn("cannot start loading as manifest not parsed yet"),this.state=y.STOPPED}},{key:"stopLoad",value:function(){var a=this.fragCurrent;a&&(a.loader&&a.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){switch(this.state){case y.ERROR:break;case y.BUFFER_FLUSHING:this.fragLoadError=0;break;case y.IDLE:if(!this._doTickIdle())return;break;case y.WAITING_LEVEL:var a=this.levels[this.level];a&&a.details&&(this.state=y.IDLE);break;case y.FRAG_LOADING_WAITING_RETRY:var b=performance.now(),c=this.retryDate;(!c||b>=c||this.media&&this.media.seeking)&&(x.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=y.IDLE);break;case y.ERROR:case y.STOPPED:case y.FRAG_LOADING:case y.PARSING:case y.PARSED:case y.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function(){var a=this.hls,b=a.config,c=this.media;if(void 0!==this.levelLastLoaded&&!c&&(this.startFragRequested||!b.startFragPrefetch))return!0;var d=void 0;d=this.loadedmetadata?c.currentTime:this.nextLoadPosition;var e=a.nextLoadLevel,f=this.levels[e],g=f.bitrate,h=void 0;h=g?Math.max(8*b.maxBufferSize/g,b.maxBufferLength):b.maxBufferLength,h=Math.min(h,b.maxMaxBufferLength);var i=l["default"].bufferInfo(this.mediaBuffer?this.mediaBuffer:c,d,b.maxBufferHole),j=i.len;if(j>=h)return!0;x.logger.trace("buffer length of "+j.toFixed(3)+" is below max of "+h.toFixed(3)+". checking for more payload ..."),this.level=a.nextLoadLevel=e;var k=f.details;if("undefined"==typeof k||k.live&&this.levelLastLoaded!==e)return this.state=y.WAITING_LEVEL,!0;var m=this.fragPrevious;if(!k.live&&m&&m.sn===k.endSN&&c.duration-Math.max(i.end,m.start)<=Math.max(.2,m.duration/2)){var n={};return this.altAudio&&(n.type="video"),this.hls.trigger(p["default"].BUFFER_EOS,n),this.state=y.ENDED,!0}return this._fetchPayloadOrEos(d,i,k)}},{key:"_fetchPayloadOrEos",value:function(a,b,c){var d=this.fragPrevious,e=this.level,f=c.fragments,g=f.length;if(0===g)return!1;var h=f[0].start,i=f[g-1].start+f[g-1].duration,j=b.end,k=void 0;if(c.live){var l=this.config.initialLiveManifestSize;if(g<l)return x.logger.warn("Can not start playback of a level, reason: not enough fragments "+g+" < "+l),!1;if(k=this._ensureFragmentAtLivePoint(c,j,h,i,d,f,g),null===k)return!1}else j<h&&(k=f[0]);return k||(k=this._findFragment(h,d,g,f,j,i,c)),!k||this._loadFragmentOrKey(k,e,c,a,j);
}},{key:"_ensureFragmentAtLivePoint",value:function(a,b,c,d,e,f,g){var h=this.hls.config,i=this.media,j=void 0,k=void 0!==h.liveMaxLatencyDuration?h.liveMaxLatencyDuration:h.liveMaxLatencyDurationCount*a.targetduration;if(b<Math.max(c-h.maxFragLookUpTolerance,d-k)){var l=this.liveSyncPosition=this.computeLivePosition(c,a);x.logger.log("buffer end: "+b.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+l.toFixed(3)),b=l,i&&i.readyState&&i.duration>l&&(i.currentTime=l)}if(a.PTSKnown&&b>d&&i&&i.readyState)return null;if(this.startFragRequested&&!a.PTSKnown){if(e){var m=e.sn+1;m>=a.startSN&&m<=a.endSN&&(j=f[m-a.startSN],x.logger.log("live playlist, switching playlist, load frag with next SN: "+j.sn))}j||(j=f[Math.min(g-1,Math.round(g/2))],x.logger.log("live playlist, switching playlist, unknown, load middle frag : "+j.sn))}return j}},{key:"_findFragment",value:function(a,b,c,d,e,f,g){var h=this.hls.config,i=void 0,k=void 0,l=h.maxFragLookUpTolerance;if(e<f?(e>f-l&&(l=0),k=j["default"].search(d,function(a){return a.start+a.duration-l<=e?1:a.start-l>e&&a.start?-1:0})):k=d[c-1],k&&(i=k,a=k.start,b&&i.level===b.level&&i.sn===b.sn))if(i.sn<g.endSN){var m=b.deltaPTS,n=i.sn-g.startSN;m&&m>h.maxBufferHole&&b.dropped&&n?(i=d[n-1],x.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),b.loadCounter--):(i=d[n+1],x.logger.log("SN just loaded, load next one: "+i.sn))}else i=null;return i}},{key:"_loadFragmentOrKey",value:function(a,b,c,d,e){var f=this.hls,g=f.config;if(null==a.decryptdata.uri||null!=a.decryptdata.key){if(x.logger.log("Loading "+a.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+b+", currentTime:"+d.toFixed(3)+",bufferEnd:"+e.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,a.loadCounter){a.loadCounter++;var h=g.fragLoadingLoopThreshold;if(a.loadCounter>h&&Math.abs(this.fragLoadIdx-a.loadIdx)<h)return f.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:a}),!1}else a.loadCounter=1;return a.loadIdx=this.fragLoadIdx,this.fragCurrent=a,this.startFragRequested=!0,this.nextLoadPosition=a.start+a.duration,a.autoLevel=f.autoLevelEnabled,a.bitrateTest=this.bitrateTest,f.trigger(p["default"].FRAG_LOADING,{frag:a}),this.demuxer||(this.demuxer=new n["default"](f,"main")),this.state=y.FRAG_LOADING,!0}x.logger.log("Loading key for "+a.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+b),this.state=y.KEY_LOADING,f.trigger(p["default"].KEY_LOADING,{frag:a})}},{key:"getBufferRange",value:function(a){return j["default"].search(this.bufferRange,function(b){return a<b.start?-1:a>b.end?1:0})}},{key:"followingBufferRange",value:function(a){return a?this.getBufferRange(a.end+.5):null}},{key:"_checkFragmentChanged",value:function(){var a,b,c=this.media;if(c&&c.readyState&&c.seeking===!1&&(b=c.currentTime,b>c.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=b),l["default"].isBuffered(c,b)?a=this.getBufferRange(b):l["default"].isBuffered(c,b+.1)&&(a=this.getBufferRange(b+.1)),a)){var d=a.frag;d!==this.fragPlaying&&(this.fragPlaying=d,this.hls.trigger(p["default"].FRAG_CHANGED,{frag:d}))}}},{key:"immediateLevelSwitch",value:function(){if(x.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var a=this.media,b=void 0;a?(b=a.paused,a.pause()):b=!0,this.previouslyPaused=b}var c=this.fragCurrent;c&&c.loader&&c.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function(){var a=this.media;a&&a.buffered.length&&(this.immediateSwitch=!1,l["default"].isBuffered(a,a.currentTime)&&(a.currentTime-=1e-4),this.previouslyPaused||a.play())}},{key:"nextLevelSwitch",value:function(){var a=this.media;if(a&&a.readyState){var b=void 0,c=void 0,d=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,c=this.getBufferRange(a.currentTime),c&&c.start>1&&this.flushMainBuffer(0,c.start-1),a.paused)b=0;else{var e=this.hls.nextLoadLevel,f=this.levels[e],g=this.fragLastKbps;b=g&&this.fragCurrent?this.fragCurrent.duration*f.bitrate/(1e3*g)+1:0}if(d=this.getBufferRange(a.currentTime+b),d&&(d=this.followingBufferRange(d))){var h=this.fragCurrent;h&&h.loader&&h.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(d.start,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function(a,b){this.state=y.BUFFER_FLUSHING;var c={startOffset:a,endOffset:b};this.altAudio&&(c.type="video"),this.hls.trigger(p["default"].BUFFER_FLUSHING,c)}},{key:"onMediaAttached",value:function(a){var b=this.media=this.mediaBuffer=a.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),b.addEventListener("seeking",this.onvseeking),b.addEventListener("seeked",this.onvseeked),b.addEventListener("ended",this.onvended);var c=this.config;this.levels&&c.autoStartLoad&&this.hls.startLoad(c.startPosition)}},{key:"onMediaDetaching",value:function(){var a=this.media;a&&a.ended&&(x.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var b=this.levels;b&&b.forEach(function(a){a.details&&a.details.fragments.forEach(function(a){a.loadCounter=void 0})}),a&&(a.removeEventListener("seeking",this.onvseeking),a.removeEventListener("seeked",this.onvseeked),a.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){var a=this.media,b=a?a.currentTime:void 0,c=this.config;if(x.logger.log("media seeking to "+b.toFixed(3)),this.state===y.FRAG_LOADING){var d=this.mediaBuffer?this.mediaBuffer:a,e=l["default"].bufferInfo(d,b,this.config.maxBufferHole),f=this.fragCurrent;if(0===e.len&&f){var g=c.maxFragLookUpTolerance,h=f.start-g,i=f.start+f.duration+g;b<h||b>i?(f.loader&&(x.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),f.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=y.IDLE):x.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===y.ENDED&&(this.state=y.IDLE);a&&(this.lastCurrentTime=b),this.state!==y.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*c.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=b),this.tick()}},{key:"onMediaSeeked",value:function(){x.logger.log("media seeked to "+this.media.currentTime.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function(){x.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){x.logger.log("trigger BUFFER_RESET"),this.hls.trigger(p["default"].BUFFER_RESET),this.bufferRange=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function(a){var b,c=!1,d=!1;a.levels.forEach(function(a){b=a.audioCodec,b&&(b.indexOf("mp4a.40.2")!==-1&&(c=!0),b.indexOf("mp4a.40.5")!==-1&&(d=!0))}),this.audioCodecSwitch=c&&d,this.audioCodecSwitch&&x.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var e=this.config;e.autoStartLoad&&this.hls.startLoad(e.startPosition)}},{key:"onLevelLoaded",value:function(a){var b=a.details,c=a.level,d=this.levels[c],e=b.totalduration,f=0;if(x.logger.log("level "+c+" loaded ["+b.startSN+","+b.endSN+"],duration:"+e),this.levelLastLoaded=c,b.live){var g=d.details;g&&b.fragments.length>0?(t["default"].mergeDetails(g,b),f=b.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(f,g),b.PTSKnown?x.logger.log("live playlist sliding:"+f.toFixed(3)):x.logger.log("live playlist - outdated PTS, unknown sliding")):(b.PTSKnown=!1,x.logger.log("live playlist - first load, unknown sliding"))}else b.PTSKnown=!1;if(d.details=b,this.hls.trigger(p["default"].LEVEL_UPDATED,{details:b,level:c}),this.startFragRequested===!1){if(this.startPosition===-1||this.lastCurrentTime===-1){var h=b.startTimeOffset;isNaN(h)?b.live?(this.startPosition=this.computeLivePosition(f,b),x.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(h<0&&(x.logger.log("negative start time offset "+h+", count from end of last fragment"),h=f+e+h),x.logger.log("start time offset found in playlist, adjust startPosition to "+h),this.startPosition=h),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===y.WAITING_LEVEL&&(this.state=y.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===y.KEY_LOADING&&(this.state=y.IDLE,this.tick())}},{key:"onFragLoaded",value:function(a){var b=this.fragCurrent,c=a.frag;if(this.state===y.FRAG_LOADING&&b&&"main"===c.type&&c.level===b.level&&c.sn===b.sn){var d=a.stats,e=this.levels[b.level],f=e.details;if(x.logger.log("Loaded  "+b.sn+" of ["+f.startSN+" ,"+f.endSN+"],level "+b.level),this.bitrateTest=!1,c.bitrateTest===!0&&this.hls.nextLoadLevel)this.state=y.IDLE,this.startFragRequested=!1,d.tparsed=d.tbuffered=performance.now(),this.hls.trigger(p["default"].FRAG_BUFFERED,{stats:d,frag:b,id:"main"}),this.tick();else{this.state=y.PARSING,this.stats=d;var g=f.totalduration,h=isNaN(b.startDTS)?b.start:b.startDTS,i=b.level,j=b.sn,k=this.config.defaultAudioCodec||e.audioCodec;this.audioCodecSwap&&(x.logger.log("swapping playlist audio codec"),void 0===k&&(k=this.lastAudioCodec),k&&(k=k.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,x.logger.log("Parsing "+j+" of ["+f.startSN+" ,"+f.endSN+"],level "+i+", cc "+b.cc);var l=this.demuxer;l||(l=this.demuxer=new n["default"](this.hls,"main"));var m=this.media,o=m&&m.seeking,q=!o&&(f.PTSKnown||!f.live);l.push(a.payload,k,e.videoCodec,h,b.cc,i,j,g,b.decryptdata,q,null)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(a){var b=this.fragCurrent;if(b&&"main"===a.id&&a.sn===b.sn&&a.level===b.level&&this.state===y.PARSING){var c,d,e=a.tracks;if(e.audio&&this.altAudio&&delete e.audio,d=e.audio){var f=this.levels[this.level].audioCodec,g=navigator.userAgent.toLowerCase();f&&this.audioCodecSwap&&(x.logger.log("swapping playlist audio codec"),f=f.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==d.metadata.channelCount&&g.indexOf("firefox")===-1&&(f="mp4a.40.5"),g.indexOf("android")!==-1&&"audio/mpeg"!==d.container&&(f="mp4a.40.2",x.logger.log("Android: force audio codec to "+f)),d.levelCodec=f,d.id=a.id}if(d=e.video,d&&(d.levelCodec=this.levels[this.level].videoCodec,d.id=a.id),a.unique){var h={codec:"",levelCodec:""};for(c in a.tracks)d=e[c],h.container=d.container,h.codec&&(h.codec+=",",h.levelCodec+=","),d.codec&&(h.codec+=d.codec),d.levelCodec&&(h.levelCodec+=d.levelCodec);e={audiovideo:h}}this.hls.trigger(p["default"].BUFFER_CODECS,e);for(c in e){d=e[c],x.logger.log("main track:"+c+",container:"+d.container+",codecs[level/parsed]=["+d.levelCodec+"/"+d.codec+"]");var i=d.initSegment;i&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(p["default"].BUFFER_APPENDING,{type:c,data:i,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function(a){var b=this,c=this.fragCurrent;if(c&&"main"===a.id&&a.sn===c.sn&&a.level===c.level&&("audio"!==a.type||!this.altAudio)&&this.state===y.PARSING){var d=this.levels[this.level],e=this.fragCurrent;x.logger.log("Parsed "+a.type+",PTS:["+a.startPTS.toFixed(3)+","+a.endPTS.toFixed(3)+"],DTS:["+a.startDTS.toFixed(3)+"/"+a.endDTS.toFixed(3)+"],nb:"+a.nb+",dropped:"+(a.dropped||0));var f=t["default"].updateFragPTSDTS(d.details,e.sn,a.startPTS,a.endPTS,a.startDTS,a.endDTS),g=this.hls;g.trigger(p["default"].LEVEL_PTS_UPDATED,{details:d.details,level:this.level,drift:f,type:a.type,start:a.startPTS,end:a.endPTS}),"video"===a.type&&(e.dropped=a.dropped),[a.data1,a.data2].forEach(function(c){c&&(b.appended=!0,b.pendingBuffering=!0,g.trigger(p["default"].BUFFER_APPENDING,{type:a.type,data:c,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function(a){var b=this.fragCurrent;b&&"main"===a.id&&a.sn===b.sn&&a.level===b.level&&this.state===y.PARSING&&(this.stats.tparsed=performance.now(),this.state=y.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function(a){var b=!!a.url,c=a.id;if(!b){if(this.mediaBuffer!==this.media){x.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var d=this.fragCurrent;d.loader&&(x.logger.log("switching to main audio track, cancel main fragment load"),d.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=y.IDLE}var e=this.hls;e.trigger(p["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),e.trigger(p["default"].AUDIO_TRACK_SWITCHED,{id:c}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function(a){var b=a.id,c=!!this.hls.audioTracks[b].url;if(c){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(x.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=c,this.tick()}},{key:"onBufferCreated",value:function(a){var b=a.tracks,c=void 0,d=void 0,e=!1;for(var f in b){var g=b[f];"main"===g.id?(d=f,c=g,"video"===f&&(this.videoBuffer=b[f].buffer)):e=!0}e&&c?(x.logger.log("alternate track found, use "+d+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function(a){if("main"===a.parent){var b=this.state;b!==y.PARSING&&b!==y.PARSED||(this.pendingBuffering=a.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function(){var a=this;if(!(this.state!==y.PARSED||this.appended&&this.pendingBuffering)){var b=this.fragCurrent;b&&!function(){var c=a.mediaBuffer?a.mediaBuffer:a.media;x.logger.log("main buffered : "+v["default"].toString(c.buffered));var d=a.bufferRange.filter(function(a){return l["default"].isBuffered(c,(a.start+a.end)/2)});d.push({type:b.type,start:b.startPTS,end:b.endPTS,frag:b}),a.bufferRange=d.sort(function(a,b){return a.start-b.start}),a.fragPrevious=b;var e=a.stats;e.tbuffered=performance.now(),a.fragLastKbps=Math.round(8*e.total/(e.tbuffered-e.tfirst)),a.hls.trigger(p["default"].FRAG_BUFFERED,{stats:e,frag:b,id:"main"}),a.state=y.IDLE}(),this.tick()}}},{key:"onError",value:function(a){var b=a.frag||this.fragCurrent;if(!b||"main"===b.type){var c=this.media,d=c&&l["default"].isBuffered(c,c.currentTime)&&l["default"].isBuffered(c,c.currentTime+.5);switch(a.details){case w.ErrorDetails.FRAG_LOAD_ERROR:case w.ErrorDetails.FRAG_LOAD_TIMEOUT:case w.ErrorDetails.KEY_LOAD_ERROR:case w.ErrorDetails.KEY_LOAD_TIMEOUT:if(!a.fatal){var e=this.fragLoadError;e?e++:e=1;var f=this.config;if(e<=f.fragLoadingMaxRetry||d||b.autoLevel&&b.level){this.fragLoadError=e,b.loadCounter=0;var g=Math.min(Math.pow(2,e-1)*f.fragLoadingRetryDelay,f.fragLoadingMaxRetryTimeout);x.logger.warn("mediaController: frag loading failed, retry in "+g+" ms"),this.retryDate=performance.now()+g,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=y.FRAG_LOADING_WAITING_RETRY}else x.logger.error("mediaController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.hls.trigger(p["default"].ERROR,a),this.state=y.ERROR}break;case w.ErrorDetails.FRAG_LOOP_LOADING_ERROR:a.fatal||(d?(this._reduceMaxBufferLength(b.duration),this.state=y.IDLE):b.autoLevel&&0!==b.level||(a.fatal=!0,this.hls.trigger(p["default"].ERROR,a),this.state=y.ERROR));break;case w.ErrorDetails.LEVEL_LOAD_ERROR:case w.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==y.ERROR&&(a.fatal?(this.state=y.ERROR,x.logger.warn("streamController: "+a.details+",switch to "+this.state+" state ...")):this.state===y.WAITING_LEVEL&&(this.state=y.IDLE));break;case w.ErrorDetails.BUFFER_FULL_ERROR:this.state!==y.PARSING&&this.state!==y.PARSED||(d?(this._reduceMaxBufferLength(b.duration),this.state=y.IDLE):(x.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function(a){var b=this.config;b.maxMaxBufferLength>=a&&(b.maxMaxBufferLength/=2,x.logger.warn("reduce max buffer length to "+b.maxMaxBufferLength+"s and switch to IDLE state"),this.fragLoadIdx+=2*b.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function(){var a=this.media;if(a&&a.readyState){var b=a.currentTime,c=this.mediaBuffer?this.mediaBuffer:a,d=c.buffered;if(this.loadedmetadata||!d.length||a.seeking)if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var e=l["default"].bufferInfo(a,b,0),f=!(a.paused||a.ended||0===a.buffered.length),g=.5,h=b!==this.lastCurrentTime,i=this.config;if(h)this.stallReported&&(x.logger.warn("playback not stuck anymore @"+b+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(f){var j=performance.now(),k=this.hls;if(this.stalled){var m=j-this.stalled,n=e.len,o=this.nudgeRetry||0;if(n<=g&&m>1e3*i.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,x.logger.warn("playback stalling in low buffer @"+b),k.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:n}));var q=e.nextStart,r=q-b;if(q&&r<i.maxSeekHole&&r>0){this.nudgeRetry=++o;var s=o*i.nudgeOffset;x.logger.log("adjust currentTime from "+a.currentTime+" to next buffered @ "+q+" + nudge "+s),a.currentTime=q+s,this.stalled=void 0,k.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:q+s-b})}}else if(n>g&&m>1e3*i.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,x.logger.warn("playback stalling in high buffer @"+b),k.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:n})),this.stalled=void 0,this.nudgeRetry=++o,o<i.nudgeMaxRetry){var t=a.currentTime,u=t+o*i.nudgeOffset;x.logger.log("adjust currentTime from "+t+" to "+u),a.currentTime=u,k.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else x.logger.error("still stuck in high buffer @"+b+" after "+i.nudgeMaxRetry+", raise fatal error"),k.trigger(p["default"].ERROR,{type:w.ErrorTypes.MEDIA_ERROR,details:w.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=j,this.stallReported=!1}}else{this.loadedmetadata=!0;var v=this.startPosition,y=l["default"].isBuffered(c,v);b===v&&y||(x.logger.log("target start position:"+v),y||(v=d.start(0),x.logger.log("target start position not buffered, seek to buffered.start(0) "+v)),x.logger.log("adjust currentTime from "+b+" to "+v),a.currentTime=v)}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=y.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function(){var a=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferRange=this.bufferRange.filter(function(b){return l["default"].isBuffered(a,(b.start+b.end)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=y.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function(a,b){var c=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*b.targetduration;return a+Math.max(0,b.totalduration-c)}},{key:"state",set:function(a){if(this.state!==a){var b=this.state;this._state=a,x.logger.log("main stream:"+b+"->"+a),this.hls.trigger(p["default"].STREAM_STATE_TRANSITION,{previousState:b,nextState:a})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var a=this.media;if(a){var b=this.getBufferRange(a.currentTime);if(b)return b.frag.level}return-1}},{key:"nextBufferRange",get:function(){var a=this.media;return a?this.followingBufferRange(this.getBufferRange(a.currentTime)):null}},{key:"nextLevel",get:function(){var a=this.nextBufferRange;return a?a.frag.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(a){this._liveSyncPosition=a}}]),b}(r["default"]);c["default"]=z},{22:22,26:26,27:27,28:28,30:30,31:31,41:41,45:45,46:46}],13:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(28),j=d(i),k=a(27),l=d(k),m=a(42),n=d(m),o=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].MEDIA_ATTACHING,j["default"].MEDIA_DETACHING,j["default"].FRAG_PARSING_USERDATA,j["default"].MANIFEST_LOADING,j["default"].FRAG_LOADED,j["default"].LEVEL_SWITCH));if(c.hls=a,c.config=a.config,c.enabled=!0,c.Cues=a.config.cueHandler,c.config.enableCEA708Captions){var d=c,g=function(a,b){var c=null;try{c=new window.Event("addtrack")}catch(d){c=document.createEvent("Event"),c.initEvent("addtrack",!1,!1)}c.track=a,b.dispatchEvent(c)},h={newCue:function(a,b,c){if(!d.textTrack1){var e=d.getExistingTrack("1");e?(d.textTrack1=e,d.clearCurrentCues(d.textTrack1),g(d.textTrack1,d.media)):(d.textTrack1=d.createTextTrack("captions","English","en"),d.textTrack1.textTrack1=!0)}d.Cues.newCue(d.textTrack1,a,b,c)}},i={newCue:function(a,b,c){if(!d.textTrack2){var e=d.getExistingTrack("2");e?(d.textTrack2=e,d.clearCurrentCues(d.textTrack2),g(d.textTrack2,d.media)):(d.textTrack2=d.createTextTrack("captions","Spanish","es"),d.textTrack2.textTrack2=!0)}d.Cues.newCue(d.textTrack2,a,b,c)}};c.cea608Parser=new n["default"](0,h,i)}return c}return g(b,a),h(b,[{key:"clearCurrentCues",value:function(a){if(a&&a.cues)for(;a.cues.length>0;)a.removeCue(a.cues[0])}},{key:"getExistingTrack",value:function(a){var b=this.media;if(b)for(var c=0;c<b.textTracks.length;c++){var d=b.textTracks[c],e="textTrack"+a;if(d[e]===!0)return d}return null}},{key:"createTextTrack",value:function(a,b,c){if(this.media)return this.media.addTextTrack(a,b,c)}},{key:"destroy",value:function(){l["default"].prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(a){this.media=a.media}},{key:"onMediaDetaching",value:function(){this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)}},{key:"onManifestLoading",value:function(){this.lastPts=Number.NEGATIVE_INFINITY}},{key:"onLevelSwitch",value:function(){"NONE"===this.hls.currentLevel.closedCaptions?this.enabled=!1:this.enabled=!0}},{key:"onFragLoaded",value:function(a){if("main"===a.frag.type){var b=a.frag.start;b<=this.lastPts&&(this.clearCurrentCues(this.textTrack1),this.clearCurrentCues(this.textTrack2)),this.lastPts=b}}},{key:"onFragParsingUserdata",value:function(a){if(this.enabled&&this.config.enableCEA708Captions)for(var b=0;b<a.samples.length;b++){var c=this.extractCea608Data(a.samples[b].bytes);this.cea608Parser.addData(a.samples[b].pts,c)}}},{key:"extractCea608Data",value:function(a){for(var b,c,d,e,f,g=31&a[0],h=2,i=[],j=0;j<g;j++)b=a[h++],c=127&a[h++],d=127&a[h++],e=0!==(4&b),f=3&b,0===c&&0===d||e&&0===f&&(i.push(c),i.push(d));return i}}]),b}(l["default"]);c["default"]=o},{27:27,28:28,42:42}],14:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){d(this,a),this.subtle=b,this.aesIV=c}return e(a,[{key:"decrypt",value:function(a,b){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},b,a)}}]),a}();c["default"]=f},{}],15:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[],this.subMix[0]=new Uint32Array(256),this.subMix[1]=new Uint32Array(256),this.subMix[2]=new Uint32Array(256),this.subMix[3]=new Uint32Array(256),this.invSubMix=[],this.invSubMix[0]=new Uint32Array(256),this.invSubMix[1]=new Uint32Array(256),this.invSubMix[2]=new Uint32Array(256),this.invSubMix[3]=new Uint32Array(256),this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return e(a,[{key:"uint8ArrayToUint32Array_",value:function(a){for(var b=new DataView(a),c=new Uint32Array(4),d=0;d<c.length;d++)c[d]=b.getUint32(4*d);return c}},{key:"initTable",value:function(){var a=this.sBox,b=this.invSBox,c=this.subMix[0],d=this.subMix[1],e=this.subMix[2],f=this.subMix[3],g=this.invSubMix[0],h=this.invSubMix[1],i=this.invSubMix[2],j=this.invSubMix[3],k=new Uint32Array(256),l=0,m=0,n=0;for(n=0;n<256;n++)n<128?k[n]=n<<1:k[n]=n<<1^283;for(n=0;n<256;n++){var o=m^m<<1^m<<2^m<<3^m<<4;o=o>>>8^255&o^99,a[l]=o,b[o]=l;var p=k[l],q=k[p],r=k[q],s=257*k[o]^16843008*o;c[l]=s<<24|s>>>8,d[l]=s<<16|s>>>16,e[l]=s<<8|s>>>24,f[l]=s,s=16843009*r^65537*q^257*p^16843008*l,g[o]=s<<24|s>>>8,h[o]=s<<16|s>>>16,i[o]=s<<8|s>>>24,j[o]=s,l?(l=p^k[k[k[r^p]]],m^=k[k[m]]):l=m=1}}},{key:"expandKey",value:function(a){for(var b=this.uint8ArrayToUint32Array_(a),c=!0,d=0;d<b.length&&c;)c=b[d]===this.key[d],d++;if(!c){this.key=b;var e=this.keySize=b.length;if(4!==e&&6!==e&&8!==e)throw new Error("Invalid aes key size="+e);var f=this.ksRows=4*(e+6+1),g=void 0,h=void 0,i=this.keySchedule=new Uint32Array(this.ksRows),j=this.invKeySchedule=new Uint32Array(this.ksRows),k=this.sBox,l=this.rcon,m=this.invSubMix[0],n=this.invSubMix[1],o=this.invSubMix[2],p=this.invSubMix[3],q=void 0,r=void 0;for(g=0;g<f;g++)g<e?q=i[g]=b[g]:(r=q,g%e===0?(r=r<<8|r>>>24,r=k[r>>>24]<<24|k[r>>>16&255]<<16|k[r>>>8&255]<<8|k[255&r],r^=l[g/e|0]<<24):e>6&&g%e===4&&(r=k[r>>>24]<<24|k[r>>>16&255]<<16|k[r>>>8&255]<<8|k[255&r]),i[g]=q=(i[g-e]^r)>>>0);for(h=0;h<f;h++)g=f-h,r=3&h?i[g]:i[g-4],h<4||g<=4?j[h]=r:j[h]=m[k[r>>>24]]^n[k[r>>>16&255]]^o[k[r>>>8&255]]^p[k[255&r]],j[h]=j[h]>>>0}}},{key:"networkToHostOrderSwap",value:function(a){return a<<24|(65280&a)<<8|(16711680&a)>>8|a>>>24}},{key:"decrypt",value:function(a,b,c){for(var d,e,f=this.keySize+6,g=this.invKeySchedule,h=this.invSBox,i=this.invSubMix[0],j=this.invSubMix[1],k=this.invSubMix[2],l=this.invSubMix[3],m=this.uint8ArrayToUint32Array_(c),n=m[0],o=m[1],p=m[2],q=m[3],r=new Int32Array(a),s=new Int32Array(r.length),t=void 0,u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0,E=void 0;b<r.length;){for(B=this.networkToHostOrderSwap(r[b]),C=this.networkToHostOrderSwap(r[b+1]),D=this.networkToHostOrderSwap(r[b+2]),E=this.networkToHostOrderSwap(r[b+3]),x=B^g[0],y=E^g[1],z=D^g[2],A=C^g[3],d=4,e=1;e<f;e++)t=i[x>>>24]^j[y>>16&255]^k[z>>8&255]^l[255&A]^g[d],u=i[y>>>24]^j[z>>16&255]^k[A>>8&255]^l[255&x]^g[d+1],v=i[z>>>24]^j[A>>16&255]^k[x>>8&255]^l[255&y]^g[d+2],w=i[A>>>24]^j[x>>16&255]^k[y>>8&255]^l[255&z]^g[d+3],x=t,y=u,z=v,A=w,d+=4;t=h[x>>>24]<<24^h[y>>16&255]<<16^h[z>>8&255]<<8^h[255&A]^g[d],u=h[y>>>24]<<24^h[z>>16&255]<<16^h[A>>8&255]<<8^h[255&x]^g[d+1],v=h[z>>>24]<<24^h[A>>16&255]<<16^h[x>>8&255]<<8^h[255&y]^g[d+2],w=h[A>>>24]<<24^h[x>>16&255]<<16^h[y>>8&255]<<8^h[255&z]^g[d+3],d+=3,s[b]=this.networkToHostOrderSwap(t^n),s[b+1]=this.networkToHostOrderSwap(w^o),s[b+2]=this.networkToHostOrderSwap(v^p),s[b+3]=this.networkToHostOrderSwap(u^q),n=B,o=C,p=D,q=E,b+=4}return s.buffer}},{key:"destroy",value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),a}();c["default"]=f},{}],16:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(14),h=d(g),i=a(17),j=d(i),k=a(15),l=d(k),m=a(26),n=a(45),o=function(){function a(b,c){e(this,a),this.observer=b,this.config=c;try{var d=crypto?crypto:self.crypto;this.subtle=d.subtle||d.webkitSubtle}catch(f){}this.disableWebCrypto=!this.subtle}return f(a,[{key:"decrypt",value:function(a,b,c,d){var e=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){n.logger.log("JS AES decrypt");var f=this.decryptor;f||(this.decryptor=f=new l["default"]),f.expandKey(b),d(f.decrypt(a,0,c))}else!function(){n.logger.log("WebCrypto AES decrypt");var f=e.subtle;e.key!==b&&(e.key=b,e.fastAesKey=new j["default"](f,b)),e.fastAesKey.expandKey().then(function(b){var e=new h["default"](f,c);e.decrypt(a,b).then(function(a){d(a)})})["catch"](function(f){e.onWebCryptoError(f,a,b,c,d)})}()}},{key:"onWebCryptoError",value:function(a,b,c,d,e){this.config.enableSoftwareAES?(n.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.decrypt(b,c,d,e)):(n.logger.error("decrypting error : "+a.message),this.observer.trigger(Event.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:a.message}))}},{key:"destroy",value:function(){var a=this.decryptor;a&&(a.destroy(),this.decryptor=void 0)}}]),a}();c["default"]=o},{14:14,15:15,17:17,26:26,45:45}],17:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){d(this,a),this.subtle=b,this.key=c}return e(a,[{key:"expandKey",value:function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),a}();c["default"]=f},{}],18:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){
for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(19),h=d(g),i=a(45),j=a(24),k=d(j),l=function(){function a(b,c,d,f,g){e(this,a),this.observer=b,this.id=c,this.remuxerClass=d,this.config=f,this.remuxer=new this.remuxerClass(b,c,f,g),this.insertDiscontinuity()}return f(a,[{key:"insertDiscontinuity",value:function(){this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0}}},{key:"push",value:function(a,b,c,d,e,f,g,j,l,m){var n,o,p,q,r,s,t,u,v,w,x=new k["default"](a),y=90*x.timeStamp,z=!1;for(e!==this.lastCC?(i.logger.log(this.id+" discontinuity detected"),this.lastCC=e,this.insertDiscontinuity(),this.remuxer.switchLevel(),this.remuxer.insertDiscontinuity()):f!==this.lastLevel?(i.logger.log("audio track switch detected"),this.lastLevel=f,this.remuxer.switchLevel(),this.insertDiscontinuity()):g===this.lastSN+1&&(z=!0),n=this._aacTrack,this.lastSN=g,this.lastLevel=f,s=x.length,v=a.length;s<v-1&&(255!==a[s]||240!==(240&a[s+1]));s++);for(n.audiosamplerate||(o=h["default"].getAudioConfig(this.observer,a,s,b),n.config=o.config,n.audiosamplerate=o.samplerate,n.channelCount=o.channelCount,n.codec=o.codec,n.manifestCodec=o.manifestCodec,n.duration=j,i.logger.log("parsed codec:"+n.codec+",rate:"+o.samplerate+",nb channel:"+o.channelCount)),r=0,q=9216e4/n.audiosamplerate;s+5<v&&(t=1&a[s+1]?7:9,p=(3&a[s+3])<<11|a[s+4]<<3|(224&a[s+5])>>>5,p-=t,p>0&&s+t+p<=v);)for(u=y+r*q,w={unit:a.subarray(s+t,s+t+p),pts:u,dts:u},n.samples.push(w),n.len+=p,s+=p+t,r++;s<v-1&&(255!==a[s]||240!==(240&a[s+1]));s++);this.remuxer.remux(f,g,e,n,{samples:[]},{samples:[{pts:y,dts:y,unit:x.payload}]},{samples:[]},d,z,l,m)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(a){var b,c,d=new k["default"](a);if(d.hasTimeStamp)for(b=d.length,c=a.length;b<c-1;b++)if(255===a[b]&&240===(240&a[b+1]))return!0;return!1}}]),a}();c["default"]=l},{19:19,24:24,45:45}],19:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(45),g=a(26),h=function(){function a(){d(this,a)}return e(a,null,[{key:"getAudioConfig",value:function(a,b,c,d){var e,h,i,j,k,l=navigator.userAgent.toLowerCase(),m=d,n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return e=((192&b[c+2])>>>6)+1,h=(60&b[c+2])>>>2,h>n.length-1?void a.trigger(Event.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+h}):(j=(1&b[c+2])<<2,j|=(192&b[c+3])>>>6,f.logger.log("manifest codec:"+d+",ADTS data:type:"+e+",sampleingIndex:"+h+"["+n[h]+"Hz],channelConfig:"+j),/firefox/i.test(l)?h>=6?(e=5,k=new Array(4),i=h-3):(e=2,k=new Array(2),i=h):l.indexOf("android")!==-1?(e=2,k=new Array(2),i=h):(e=5,k=new Array(4),d&&(d.indexOf("mp4a.40.29")!==-1||d.indexOf("mp4a.40.5")!==-1)||!d&&h>=6?i=h-3:((d&&d.indexOf("mp4a.40.2")!==-1&&h>=6&&1===j||!d&&1===j)&&(e=2,k=new Array(2)),i=h)),k[0]=e<<3,k[0]|=(14&h)>>1,k[1]|=(1&h)<<7,k[1]|=j<<3,5===e&&(k[1]|=(14&i)>>1,k[2]=(1&i)<<7,k[2]|=8,k[3]=0),{config:k,samplerate:n[h],channelCount:j,codec:"mp4a.40."+e,manifestCodec:m})}}]),a}();c["default"]=h},{26:26,45:45}],20:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(28),h=d(g),i=a(26),j=a(16),k=d(j),l=a(18),m=d(l),n=a(25),o=d(n),p=a(38),q=d(p),r=a(39),s=d(r),t=function(){function a(b,c,d){var f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e(this,a),this.hls=b,this.id=c,this.config=this.hls.config||f,this.typeSupported=d}return f(a,[{key:"destroy",value:function(){var a=this.demuxer;a&&a.destroy()}},{key:"push",value:function(a,b,c,d,e,f,g,i,j,l,m){if(a.byteLength>0&&null!=j&&null!=j.key&&"AES-128"===j.method){null==this.decrypter&&(this.decrypter=new k["default"](this.hls,this.config));var n,o=this;try{n=performance.now()}catch(p){n=Date.now()}this.decrypter.decrypt(a,j.key.buffer,j.iv.buffer,function(a){var j;try{j=performance.now()}catch(k){j=Date.now()}o.hls.trigger(h["default"].FRAG_DECRYPTED,{level:f,sn:g,stats:{tstart:n,tdecrypt:j}}),o.pushDecrypted(new Uint8Array(a),b,c,d,e,f,g,i,l,m)})}else this.pushDecrypted(new Uint8Array(a),b,c,d,e,f,g,i,l,m)}},{key:"pushDecrypted",value:function(a,b,c,d,e,f,g,j,k,l){var n=this.demuxer;if(!n||e!==this.cc&&!n.probe(a)){var p=this.hls,r=this.id,t=this.config,u=this.typeSupported;if(o["default"].probe(a))n=this.typeSupported.mp2t===!0?new o["default"](p,r,s["default"],t,u):new o["default"](p,r,q["default"],t,u),n.probe=o["default"].probe;else{if(!m["default"].probe(a))return void p.trigger(h["default"].ERROR,{type:i.ErrorTypes.MEDIA_ERROR,id:r,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});n=new m["default"](p,r,q["default"],t,u),n.probe=m["default"].probe}this.demuxer=n}n.push(a,b,c,d,e,f,g,j,k,l),this.cc=e}}]),a}();c["default"]=t},{16:16,18:18,25:25,26:26,28:28,38:38,39:39}],21:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(c,"__esModule",{value:!0});var e=a(20),f=d(e),g=a(28),h=d(g),i=a(45),j=a(1),k=d(j),l=function(a){var b=new k["default"];b.trigger=function(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];b.emit.apply(b,[a,a].concat(d))},b.off=function(a){for(var c=arguments.length,d=Array(c>1?c-1:0),e=1;e<c;e++)d[e-1]=arguments[e];b.removeListener.apply(b,[a].concat(d))};var c=function(b,c){a.postMessage({event:b,data:c})};a.addEventListener("message",function(d){var e=d.data;switch(e.cmd){case"init":var g=JSON.parse(e.config);a.demuxer=new f["default"](b,e.id,e.typeSupported,g);try{(0,i.enableLogs)(g.debug===!0)}catch(h){}c("init",null);break;case"demux":a.demuxer.push(e.data,e.audioCodec,e.videoCodec,e.timeOffset,e.cc,e.level,e.sn,e.duration,e.decryptdata,e.accurateTimeOffset,e.defaultInitPTS)}}),b.on(h["default"].FRAG_DECRYPTED,c),b.on(h["default"].FRAG_PARSING_INIT_SEGMENT,c),b.on(h["default"].FRAG_PARSED,c),b.on(h["default"].ERROR,c),b.on(h["default"].FRAG_PARSING_METADATA,c),b.on(h["default"].FRAG_PARSING_USERDATA,c),b.on(h["default"].INIT_PTS_FOUND,c),b.on(h["default"].FRAG_PARSING_DATA,function(b,c){var d=c.data1.buffer,e=c.data2.buffer;delete c.data1,delete c.data2,a.postMessage({event:b,data:c,data1:d,data2:e},[d,e])})};c["default"]=l},{1:1,20:20,28:28,45:45}],22:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(28),h=d(g),i=a(20),j=d(i),k=a(21),l=d(k),m=a(45),n=a(26),o=function(){function b(c,d){e(this,b),this.hls=c,this.id=d;var f={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:c.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')};if(c.config.enableWorker&&"undefined"!=typeof Worker){m.logger.log("demuxing in webworker");var g=void 0;try{var i=a(3);g=this.w=i(l["default"]),this.onwmsg=this.onWorkerMessage.bind(this),g.addEventListener("message",this.onwmsg),g.onerror=function(a){c.trigger(h["default"].ERROR,{type:n.ErrorTypes.OTHER_ERROR,details:n.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:a.message+" ("+a.filename+":"+a.lineno+")"}})},g.postMessage({cmd:"init",typeSupported:f,id:d,config:JSON.stringify(c.config)})}catch(k){m.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),g&&URL.revokeObjectURL(g.objectURL),this.demuxer=new j["default"](c,d,f),this.w=void 0}}else this.demuxer=new j["default"](c,d,f);this.demuxInitialized=!0}return f(b,[{key:"destroy",value:function(){var a=this.w;if(a)a.removeEventListener("message",this.onwmsg),a.terminate(),this.w=null;else{var b=this.demuxer;b&&(b.destroy(),this.demuxer=null)}}},{key:"push",value:function(a,b,c,d,e,f,g,h,i,j,k){var l=this.w;if(l)l.postMessage({cmd:"demux",data:a,audioCodec:b,videoCodec:c,timeOffset:d,cc:e,level:f,sn:g,duration:h,decryptdata:i,accurateTimeOffset:j,defaultInitPTS:k},[a]);else{var m=this.demuxer;m&&m.push(a,b,c,d,e,f,g,h,i,j,k)}}},{key:"onWorkerMessage",value:function(a){var b=a.data,c=this.hls;switch(b.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case h["default"].FRAG_PARSING_DATA:b.data.data1=new Uint8Array(b.data1),b.data.data2=new Uint8Array(b.data2);default:c.trigger(b.event,b.data)}}}]),b}();c["default"]=o},{20:20,21:21,26:26,28:28,3:3,45:45}],23:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(45),g=function(){function a(b){d(this,a),this.data=b,this.bytesAvailable=b.byteLength,this.word=0,this.bitsAvailable=0}return e(a,[{key:"loadWord",value:function(){var a=this.data,b=this.bytesAvailable,c=a.byteLength-b,d=new Uint8Array(4),e=Math.min(4,b);if(0===e)throw new Error("no bytes available");d.set(a.subarray(c,c+e)),this.word=new DataView(d.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e}},{key:"skipBits",value:function(a){var b;this.bitsAvailable>a?(this.word<<=a,this.bitsAvailable-=a):(a-=this.bitsAvailable,b=a>>3,a-=b>>3,this.bytesAvailable-=b,this.loadWord(),this.word<<=a,this.bitsAvailable-=a)}},{key:"readBits",value:function(a){var b=Math.min(this.bitsAvailable,a),c=this.word>>>32-b;return a>32&&f.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=b,this.bitsAvailable>0?this.word<<=b:this.bytesAvailable>0&&this.loadWord(),b=a-b,b>0&&this.bitsAvailable?c<<b|this.readBits(b):c}},{key:"skipLZ",value:function(){var a;for(a=0;a<this.bitsAvailable;++a)if(0!==(this.word&2147483648>>>a))return this.word<<=a,this.bitsAvailable-=a,a;return this.loadWord(),a+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var a=this.skipLZ();return this.readBits(a+1)-1}},{key:"readEG",value:function(){var a=this.readUEG();return 1&a?1+a>>>1:-1*(a>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(a){var b,c,d=8,e=8;for(b=0;b<a;b++)0!==e&&(c=this.readEG(),e=(d+c+256)%256),d=0===e?d:e}},{key:"readSPS",value:function(){var a,b,c,d,e,f,g,h,i,j=0,k=0,l=0,m=0,n=this.readUByte.bind(this),o=this.readBits.bind(this),p=this.readUEG.bind(this),q=this.readBoolean.bind(this),r=this.skipBits.bind(this),s=this.skipEG.bind(this),t=this.skipUEG.bind(this),u=this.skipScalingList.bind(this);if(n(),a=n(),b=o(5),r(3),c=n(),t(),100===a||110===a||122===a||244===a||44===a||83===a||86===a||118===a||128===a){var v=p();if(3===v&&r(1),t(),t(),r(1),q())for(h=3!==v?8:12,i=0;i<h;i++)q()&&u(i<6?16:64)}t();var w=p();if(0===w)p();else if(1===w)for(r(1),s(),s(),d=p(),i=0;i<d;i++)s();t(),r(1),e=p(),f=p(),g=o(1),0===g&&r(1),r(1),q()&&(j=p(),k=p(),l=p(),m=p());var x=[1,1];if(q()&&q()){var y=n();switch(y){case 1:x=[1,1];break;case 2:x=[12,11];break;case 3:x=[10,11];break;case 4:x=[16,11];break;case 5:x=[40,33];break;case 6:x=[24,11];break;case 7:x=[20,11];break;case 8:x=[32,11];break;case 9:x=[80,33];break;case 10:x=[18,11];break;case 11:x=[15,11];break;case 12:x=[64,33];break;case 13:x=[160,99];break;case 14:x=[4,3];break;case 15:x=[3,2];break;case 16:x=[2,1];break;case 255:x=[n()<<8|n(),n()<<8|n()]}}return{width:Math.ceil(16*(e+1)-2*j-2*k),height:(2-g)*(f+1)*16-(g?2:4)*(l+m),pixelRatio:x}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),a}();c["default"]=g},{45:45}],24:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(45),g=function(){function a(b){d(this,a),this._hasTimeStamp=!1;for(var c,e,g,h,i,j,k,l,m=0;;)if(k=this.readUTF(b,m,3),m+=3,"ID3"===k)m+=3,c=127&b[m++],e=127&b[m++],g=127&b[m++],h=127&b[m++],i=(c<<21)+(e<<14)+(g<<7)+h,j=m+i,this._parseID3Frames(b,m,j),m=j;else{if("3DI"!==k)return m-=3,l=m,void(l&&(this.hasTimeStamp||f.logger.warn("ID3 tag found, but no timestamp"),this._length=l,this._payload=b.subarray(0,l)));m+=7,f.logger.log("3DI footer found, end: "+m)}}return e(a,[{key:"readUTF",value:function(a,b,c){var d="",e=b,f=b+c;do d+=String.fromCharCode(a[e++]);while(e<f);return d}},{key:"_parseID3Frames",value:function(a,b,c){for(var d,e,g,h,i;b+8<=c;)switch(d=this.readUTF(a,b,4),b+=4,e=a[b++]<<24+a[b++]<<16+a[b++]<<8+a[b++],h=a[b++]<<8+a[b++],g=b,d){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(a,b,44)){b+=44,b+=4;var j=1&a[b++];this._hasTimeStamp=!0,i=((a[b++]<<23)+(a[b++]<<15)+(a[b++]<<7)+a[b++])/45,j&&(i+=47721858.84),i=Math.round(i),f.logger.trace("ID3 timestamp found: "+i),this._timeStamp=i}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),a}();c["default"]=g},{45:45}],25:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(19),h=d(g),i=a(28),j=d(i),k=a(23),l=d(k),m=a(45),n=a(26),o=function(){function a(b,c,d,f,g){e(this,a),this.observer=b,this.id=c,this.remuxerClass=d,this.config=f,this.typeSupported=g,this.lastCC=0,this.remuxer=new this.remuxerClass(b,c,f,g)}return f(a,[{key:"switchLevel",value:function(){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"push",value:function(a,b,c,d,e,f,g,h,i,k){var l,o,p,q,r,s,t=a.length,u=this.remuxer.passthrough,v=!1;this.audioCodec=b,this.videoCodec=c,this._duration=h,this.contiguous=!1,this.accurateTimeOffset=i,e!==this.lastCC&&(m.logger.log("discontinuity detected"),this.insertDiscontinuity(),this.lastCC=e),f!==this.lastLevel?(m.logger.log("level switch detected"),this.switchLevel(),this.lastLevel=f):g===this.lastSN+1&&(this.contiguous=!0),this.lastSN=g;var w=this.pmtParsed,x=this._avcTrack,y=this._audioTrack,z=this._id3Track,A=x.id,B=y.id,C=z.id,D=this._pmtId,E=x.pesData,F=y.pesData,G=z.pesData,H=this._parsePAT,I=this._parsePMT,J=this._parsePES,K=this._parseAVCPES.bind(this),L=this._parseAACPES.bind(this),M=this._parseMPEGPES.bind(this),N=this._parseID3PES.bind(this);for(t-=t%188,l=0;l<t;l+=188)if(71===a[l]){if(o=!!(64&a[l+1]),p=((31&a[l+1])<<8)+a[l+2],q=(48&a[l+3])>>4,q>1){if(r=l+5+a[l+4],r===l+188)continue}else r=l+4;switch(p){case A:if(o){if(E&&(s=J(E))&&(K(s,!1),u&&x.codec&&(B===-1||y.codec)))return void this.remux(f,g,e,a,d);E={data:[],size:0}}E&&(E.data.push(a.subarray(r,l+188)),E.size+=l+188-r);break;case B:if(o){if(F&&(s=J(F))&&(y.isAAC?L(s):M(s),u&&y.codec&&(A===-1||x.codec)))return void this.remux(f,g,e,a,d);F={data:[],size:0}}F&&(F.data.push(a.subarray(r,l+188)),F.size+=l+188-r);break;case C:o&&(G&&(s=J(G))&&N(s),G={data:[],size:0}),G&&(G.data.push(a.subarray(r,l+188)),G.size+=l+188-r);break;case 0:o&&(r+=a[r]+1),D=this._pmtId=H(a,r);break;case D:o&&(r+=a[r]+1);var O=I(a,r,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0);A=O.avc,A>0&&(x.id=A),B=O.audio,B>0&&(y.id=B,y.isAAC=O.isAAC),C=O.id3,C>0&&(z.id=C),v&&!w&&(m.logger.log("reparse from beginning"),v=!1,l=-188),w=this.pmtParsed=!0;break;case 17:case 8191:break;default:v=!0}}else this.observer.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,id:this.id,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});E&&(s=J(E))?(K(s,!0),x.pesData=null):x.pesData=E,F&&(s=J(F))?(y.isAAC?L(s):M(s),y.pesData=null):(F&&F.size&&m.logger.log("last AAC PES packet truncated,might overlap between fragments"),y.pesData=F),G&&(s=J(G))?(N(s),z.pesData=null):z.pesData=G,this.remux(f,g,e,null,d,k)}},{key:"remux",value:function(a,b,c,d,e,f){for(var g=this._avcTrack,h=g.samples,i=0,j=0,k=0;k<h.length;k++){for(var l=h[k],m=l.units.units,n=m.length,o=0,p=0;p<n;p++)o+=m[p].data.length;j+=o,i+=n,l.length=o}g.len=j,g.nbNalu=i,this.remuxer.remux(a,b,c,this._audioTrack,this._avcTrack,this._id3Track,this._txtTrack,e,this.contiguous,this.accurateTimeOffset,f,d)}},{key:"destroy",value:function(){this.switchLevel(),this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(a,b){return(31&a[b+10])<<8|a[b+11]}},{key:"_parsePMT",value:function(a,b,c){var d,e,f,g,h={audio:-1,avc:-1,id3:-1,isAAC:!0};for(d=(15&a[b+1])<<8|a[b+2],e=b+3+d-4,f=(15&a[b+10])<<8|a[b+11],b+=12+f;b<e;){switch(g=(31&a[b+1])<<8|a[b+2],a[b]){case 15:h.audio===-1&&(h.audio=g);break;case 21:h.id3===-1&&(h.id3=g);break;case 27:h.avc===-1&&(h.avc=g);break;case 3:case 4:c?h.audio===-1&&(h.audio=g,h.isAAC=!1):m.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:m.logger.warn("HEVC stream type found, not supported for now");break;default:m.logger.log("unkown stream type:"+a[b])}b+=((15&a[b+3])<<8|a[b+4])+5}return h}},{key:"_parsePES",value:function(a){var b,c,d,e,f,g,h,i,j,k=0,l=a.data;if(!a||0===a.size)return null;for(;l[0].length<19&&l.length>1;){var n=new Uint8Array(l[0].length+l[1].length);n.set(l[0]),n.set(l[1],l[0].length),l[0]=n,l.splice(1,1)}if(b=l[0],d=(b[0]<<16)+(b[1]<<8)+b[2],1===d){if(e=(b[4]<<8)+b[5],e&&e>a.size-6)return null;c=b[7],192&c&&(h=536870912*(14&b[9])+4194304*(255&b[10])+16384*(254&b[11])+128*(255&b[12])+(254&b[13])/2,h>4294967295&&(h-=8589934592),64&c?(i=536870912*(14&b[14])+4194304*(255&b[15])+16384*(254&b[16])+128*(255&b[17])+(254&b[18])/2,i>4294967295&&(i-=8589934592),h-i>54e5&&(m.logger.warn(Math.round((h-i)/9e4)+"s delta between PTS and DTS, align them"),h=i)):i=h),f=b[8],j=f+9,a.size-=j,g=new Uint8Array(a.size);for(var o=0,p=l.length;o<p;o++){b=l[o];var q=b.byteLength;if(j){if(j>q){j-=q;continue}b=b.subarray(j),q-=j,j=0}g.set(b,k),k+=q}return e&&(e-=f+3),{data:g,pts:h,dts:i,len:e}}return null}},{key:"pushAccesUnit",value:function(a,b){a.units.units.length&&a.frame&&(!this.config.forceKeyFrameOnDiscontinuity||a.key===!0||b.sps&&(b.samples.length||this.contiguous)?b.samples.push(a):b.dropped++),a.debug.length&&m.logger.log(a.pts+"/"+a.dts+":"+a.debug+","+a.units.length)}},{key:"_parseAVCPES",value:function(a,b){var c,d,e,f=this,g=this._avcTrack,h=this._parseAVCNALu(a.data),i=!1,j=this.avcSample;a.data=null,h.forEach(function(b){switch(b.type){case 1:d=!0,i&&j&&(j.debug+="NDR "),j.frame=!0;var h=b.data;if(h.length>4){var k=new l["default"](h).readSliceType();2!==k&&4!==k&&7!==k&&9!==k||(j.key=!0)}break;case 5:d=!0,j||(j=f.avcSample=f._createAVCSample(!0,a.pts,a.dts,"")),i&&(j.debug+="IDR "),j.key=!0,j.frame=!0;break;case 6:d=!0,i&&j&&(j.debug+="SEI "),c=new l["default"](f.discardEPB(b.data)),c.readUByte();for(var m=0,n=0,o=!1,p=0;!o&&c.bytesAvailable>1;){m=0;do p=c.readUByte(),m+=p;while(255===p);n=0;do p=c.readUByte(),n+=p;while(255===p);if(4===m&&0!==c.bytesAvailable){o=!0;var q=c.readUByte();if(181===q){var r=c.readUShort();if(49===r){var s=c.readUInt();if(1195456820===s){var t=c.readUByte();if(3===t){var u=c.readUByte(),v=c.readUByte(),w=31&u,x=[u,v];for(e=0;e<w;e++)x.push(c.readUByte()),x.push(c.readUByte()),x.push(c.readUByte());f._insertSampleInOrder(f._txtTrack.samples,{type:3,pts:a.pts,bytes:x})}}}}}else if(n<c.bytesAvailable)for(e=0;e<n;e++)c.readUByte()}break;case 7:if(d=!0,i&&j&&(j.debug+="SPS "),!g.sps){c=new l["default"](b.data);var y=c.readSPS();g.width=y.width,g.height=y.height,g.pixelRatio=y.pixelRatio,g.sps=[b.data],g.duration=f._duration;var z=b.data.subarray(1,4),A="avc1.";for(e=0;e<3;e++){var B=z[e].toString(16);B.length<2&&(B="0"+B),A+=B}g.codec=A}break;case 8:d=!0,i&&j&&(j.debug+="PPS "),g.pps||(g.pps=[b.data]);break;case 9:d=!1,j&&f.pushAccesUnit(j,g),j=f.avcSample=f._createAVCSample(!1,a.pts,a.dts,i?"AUD ":"");break;case 12:d=!1;break;default:d=!1,j&&(j.debug+="unknown NAL "+b.type+" ")}if(j&&d){var C=j.units;C.units.push(b)}}),b&&j&&(this.pushAccesUnit(j,g),this.avcSample=null)}},{key:"_createAVCSample",value:function(a,b,c,d){return{key:a,pts:b,dts:c,units:{units:[],length:0},debug:d}}},{key:"_insertSampleInOrder",value:function(a,b){var c=a.length;if(c>0){if(b.pts>=a[c-1].pts)a.push(b);else for(var d=c-1;d>=0;d--)if(b.pts<a[d].pts){a.splice(d,0,b);break}}else a.push(b)}},{key:"_getLastNalUnit",value:function(){var a=this.avcSample,b=void 0;if(!a||0===a.units.units.length){var c=this._avcTrack,d=c.samples;a=d[d.length-1]}if(a){var e=a.units.units;b=e[e.length-1]}return b}},{key:"_parseAVCNALu",value:function(a){var b,c,d,e,f,g=0,h=a.byteLength,i=this._avcTrack,j=i.naluState||0,k=j,l=[],m=-1;for(j===-1&&(m=0,f=31&a[0],j=0,g=1);g<h;)if(b=a[g++],j)if(1!==j)if(b)if(1===b){if(m>=0)d={data:a.subarray(m,g-j-1),type:f},l.push(d);else{var n=this._getLastNalUnit();if(n&&(k&&g<=4-k&&n.state&&(n.data=n.data.subarray(0,n.data.byteLength-k)),c=g-j-1,c>0)){var o=new Uint8Array(n.data.byteLength+c);o.set(n.data,0),o.set(a.subarray(0,c),n.data.byteLength),n.data=o}}g<h?(e=31&a[g],m=g,f=e,j=0):j=-1}else j=0;else j=3;else j=b?0:2;else j=b?0:1;if(m>=0&&j>=0&&(d={data:a.subarray(m,h),type:f,state:j},l.push(d)),0===l.length){var p=this._getLastNalUnit();if(p){var q=new Uint8Array(p.data.byteLength+a.byteLength);q.set(p.data,0),q.set(a,p.data.byteLength),p.data=q}}return i.naluState=j,l}},{key:"discardEPB",value:function(a){for(var b,c,d=a.byteLength,e=[],f=1;f<d-2;)0===a[f]&&0===a[f+1]&&3===a[f+2]?(e.push(f+2),f+=2):f++;if(0===e.length)return a;b=d-e.length,c=new Uint8Array(b);var g=0;for(f=0;f<b;g++,f++)g===e[0]&&(g++,e.shift()),c[f]=a[g];return c}},{key:"_parseAACPES",value:function(a){var b,c,d,e,f,g,i,k,l,o=this._audioTrack,p=a.data,q=a.pts,r=0,s=this.aacOverFlow,t=this.aacLastPTS;if(s){var u=new Uint8Array(s.byteLength+p.byteLength);u.set(s,0),u.set(p,s.byteLength),p=u}for(f=r,k=p.length;f<k-1&&(255!==p[f]||240!==(240&p[f+1]));f++);if(f){var v,w;if(f<k-1?(v="AAC PES did not start with ADTS header,offset:"+f,w=!1):(v="no ADTS header found in AAC PES",w=!0),m.logger.warn("parsing error:"+v),this.observer.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,id:this.id,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:w,reason:v}),w)return}if(!o.audiosamplerate){var x=this.audioCodec;b=h["default"].getAudioConfig(this.observer,p,f,x),o.config=b.config,o.audiosamplerate=b.samplerate,o.channelCount=b.channelCount,o.codec=b.codec,o.manifestCodec=b.manifestCodec,o.duration=this._duration,m.logger.log("parsed codec:"+o.codec+",rate:"+b.samplerate+",nb channel:"+b.channelCount)}if(e=0,d=9216e4/o.audiosamplerate,s&&t){var y=t+d;Math.abs(y-q)>1&&(m.logger.log("AAC: align PTS for overlapping frames by "+Math.round((y-q)/90)),q=y)}for(;f+5<k&&(g=1&p[f+1]?7:9,c=(3&p[f+3])<<11|p[f+4]<<3|(224&p[f+5])>>>5,c-=g,c>0&&f+g+c<=k);)for(i=q+e*d,l={unit:p.subarray(f+g,f+g+c),pts:i,dts:i},o.samples.push(l),o.len+=c,f+=c+g,e++;f<k-1&&(255!==p[f]||240!==(240&p[f+1]));f++);s=f<k?p.subarray(f,k):null,this.aacOverFlow=s,this.aacLastPTS=i}},{key:"_parseMPEGPES",value:function(a){for(var b,c=a.data,d=a.pts,e=c.length,f=0,g=0;g<e&&(b=this._parseMpeg(c,g,e,f++,d))>0;)g+=b}},{key:"_onMpegFrame",value:function(a,b,c,d,e,f){var g=1152/c*1e3,h=f+e*g,i=this._audioTrack;i.config=[],i.channelCount=d,i.audiosamplerate=c,i.duration=this._duration,i.samples.push({unit:a,pts:h,dts:h}),i.len+=a.length}},{key:"_onMpegNoise",value:function(a){m.logger.warn("mpeg audio has noise: "+a.length+" bytes")}},{key:"_parseMpeg",value:function(a,b,c,d,e){var f=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],g=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];if(b+2>c)return-1;if(255===a[b]||224===(224&a[b+1])){if(b+24>c)return-1;var h=a[b+1]>>3&3,i=a[b+1]>>1&3,j=a[b+2]>>4&15,k=a[b+2]>>2&3,l=!!(2&a[b+2]);if(1!==h&&0!==j&&15!==j&&3!==k){var m=3===h?3-i:3===i?3:4,n=1e3*f[14*m+j-1],o=3===h?0:2===h?1:2,p=g[3*o+k],q=l?1:0,r=a[b+3]>>6===3?1:2,s=3===i?(3===h?12:6)*n/p+q<<2:(3===h?144:72)*n/p+q|0;return b+s>c?-1:(this._onMpegFrame&&this._onMpegFrame(a.subarray(b,b+s),n,p,r,d,e),s)}}for(var t=b+2;t<c;){if(255===a[t-1]&&224===(224&a[t]))return this._onMpegNoise&&this._onMpegNoise(a.subarray(b,t-1)),t-b-1;t++}return-1}},{key:"_parseID3PES",value:function(a){this._id3Track.samples.push(a)}}],[{key:"probe",value:function(a){return a.length>=564&&71===a[0]&&71===a[188]&&71===a[376]}}]),a}();c["default"]=o},{19:19,23:23,26:26,28:28,45:45}],26:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},c.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},{}],27:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a(45),i=a(26),j=a(28),k=d(j),l=function(){function a(b){e(this,a),this.hls=b,this.onEvent=this.onEvent.bind(this);for(var c=arguments.length,d=Array(c>1?c-1:0),f=1;f<c;f++)d[f-1]=arguments[f];this.handledEvents=d,this.useGenericHandler=!0,this.registerListeners()}return g(a,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===f(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){if("hlsEventGeneric"===a)throw new Error("Forbidden event name: "+a);this.hls.on(a,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(a){this.hls.off(a,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(a,b){this.onEventGeneric(a,b)}},{key:"onEventGeneric",value:function(a,b){var c=function(a,b){var c="on"+a.replace("hls","");if("function"!=typeof this[c])throw new Error("Event "+a+" has no generic handler in this "+this.constructor.name+" class (tried "+c+")");return this[c].bind(this,b)};try{c.call(this,a,b).call()}catch(d){h.logger.error("internal error happened while processing "+a+":"+d.message),this.hls.trigger(k["default"].ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:a,err:d})}}}]),a}();c["default"]=l},{26:26,28:28,45:45}],28:[function(a,b,c){"use strict";b.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",
FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],29:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a)}return e(a,null,[{key:"getSilentFrame",value:function(a,b){switch(a){case"mp4a.40.2":if(1===b)return new Uint8Array([0,200,0,128,35,128]);if(2===b)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===b)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===b)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===b)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),a}();c["default"]=f},{}],30:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a)}return e(a,null,[{key:"isBuffered",value:function(a,b){if(a)for(var c=a.buffered,d=0;d<c.length;d++)if(b>=c.start(d)&&b<=c.end(d))return!0;return!1}},{key:"bufferInfo",value:function(a,b,c){if(a){var d,e=a.buffered,f=[];for(d=0;d<e.length;d++)f.push({start:e.start(d),end:e.end(d)});return this.bufferedInfo(f,b,c)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"bufferedInfo",value:function(a,b,c){var d,e,f,g,h,i=[];for(a.sort(function(a,b){var c=a.start-b.start;return c?c:b.end-a.end}),h=0;h<a.length;h++){var j=i.length;if(j){var k=i[j-1].end;a[h].start-k<c?a[h].end>k&&(i[j-1].end=a[h].end):i.push(a[h])}else i.push(a[h])}for(h=0,d=0,e=f=b;h<i.length;h++){var l=i[h].start,m=i[h].end;if(b+c>=l&&b<m)e=l,f=m,d=f-b;else if(b+c<l){g=l;break}}return{len:d,start:e,end:f,nextStart:g}}}]),a}();c["default"]=f},{}],31:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(45),g=function(){function a(){d(this,a)}return e(a,null,[{key:"mergeDetails",value:function(b,c){var d,e=Math.max(b.startSN,c.startSN)-c.startSN,g=Math.min(b.endSN,c.endSN)-c.startSN,h=c.startSN-b.startSN,i=b.fragments,j=c.fragments,k=0;if(g<e)return void(c.PTSKnown=!1);for(var l=e;l<=g;l++){var m=i[h+l],n=j[l];n&&m&&(k=m.cc-n.cc,isNaN(m.startPTS)||(n.start=n.startPTS=m.startPTS,n.endPTS=m.endPTS,n.duration=m.duration,d=n))}if(k)for(f.logger.log("discontinuity sliding from playlist, take drift into account"),l=0;l<j.length;l++)j[l].cc+=k;if(d)a.updateFragPTSDTS(c,d.sn,d.startPTS,d.endPTS,d.startDTS,d.endDTS);else if(h>=0&&h<i.length){var o=i[h].start;for(l=0;l<j.length;l++)j[l].start+=o}c.PTSKnown=b.PTSKnown}},{key:"updateFragPTSDTS",value:function(b,c,d,e,f,g){var h,i,j,k;if(!b||c<b.startSN||c>b.endSN)return 0;if(h=c-b.startSN,i=b.fragments,j=i[h],!isNaN(j.startPTS)){var l=Math.abs(j.startPTS-d);isNaN(j.deltaPTS)?j.deltaPTS=l:j.deltaPTS=Math.max(l,j.deltaPTS),d=Math.min(d,j.startPTS),e=Math.max(e,j.endPTS),f=Math.min(f,j.startDTS),g=Math.max(g,j.endDTS)}var m=d-j.start;for(j.start=j.startPTS=d,j.endPTS=e,j.startDTS=f,j.endDTS=g,j.duration=e-d,k=h;k>0;k--)a.updatePTS(i,k,k-1);for(k=h;k<i.length-1;k++)a.updatePTS(i,k,k+1);return b.PTSKnown=!0,m}},{key:"updatePTS",value:function(a,b,c){var d=a[b],e=a[c],g=e.startPTS;isNaN(g)?c>b?e.start=d.start+d.duration:e.start=d.start-e.duration:c>b?(d.duration=g-d.start,d.duration<0&&f.logger.warn("negative duration computed for frag "+d.sn+",level "+d.level+", there should be some duration drift between playlist and fragment!")):(e.duration=d.start-g,e.duration<0&&f.logger.warn("negative duration computed for frag "+e.sn+",level "+e.level+", there should be some duration drift between playlist and fragment!"))}}]),a}();c["default"]=g},{45:45}],32:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(28),h=d(g),i=a(26),j=a(36),k=d(j),l=a(34),m=d(l),n=a(4),o=d(n),p=a(7),q=d(p),r=a(8),s=d(r),t=a(5),u=d(t),v=a(12),w=d(v),x=a(11),y=d(x),z=a(13),A=d(z),B=a(10),C=d(B),D=a(6),E=d(D),F=a(45),G=a(47),H=d(G),I=a(1),J=d(I),K=a(35),L=d(K),M=a(43),N=d(M),O=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e(this,a);var c=a.DefaultConfig;if((b.liveSyncDurationCount||b.liveMaxLatencyDurationCount)&&(b.liveSyncDuration||b.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var d in c)d in b||(b[d]=c[d]);if(void 0!==b.liveMaxLatencyDurationCount&&b.liveMaxLatencyDurationCount<=b.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==b.liveMaxLatencyDuration&&(b.liveMaxLatencyDuration<=b.liveSyncDuration||void 0===b.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,F.enableLogs)(b.debug),this.config=b;var f=this.observer=new J["default"];f.trigger=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];f.emit.apply(f,[a,a].concat(c))},f.off=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];f.removeListener.apply(f,[a].concat(c))},this.on=f.on.bind(f),this.off=f.off.bind(f),this.trigger=f.trigger.bind(f),this.playlistLoader=new k["default"](this),this.fragmentLoader=new m["default"](this),this.levelController=new y["default"](this),this.abrController=new b.abrController(this),this.bufferController=new b.bufferController(this),this.capLevelController=new b.capLevelController(this),this.fpsController=new b.fpsController(this),this.streamController=new b.streamController(this),this.audioStreamController=new b.audioStreamController(this),this.timelineController=new b.timelineController(this),this.audioTrackController=new E["default"](this),this.keyLoader=new L["default"](this)}return f(a,null,[{key:"isSupported",value:function(){return window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource&&"function"==typeof window.MediaSource.isTypeSupported&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"version",get:function(){return"0.6.21"}},{key:"Events",get:function(){return h["default"]}},{key:"ErrorTypes",get:function(){return i.ErrorTypes}},{key:"ErrorDetails",get:function(){return i.ErrorDetails}},{key:"DefaultConfig",get:function(){return a.defaultConfig||(a.defaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxMaxBufferLength:600,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:H["default"],fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:o["default"],bufferController:q["default"],capLevelController:s["default"],fpsController:C["default"],streamController:w["default"],audioStreamController:u["default"],timelineController:A["default"],cueHandler:N["default"],enableCEA708Captions:!0,enableMP2TPassThrough:!1,stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}),a.defaultConfig},set:function(b){a.defaultConfig=b}}]),f(a,[{key:"destroy",value:function(){F.logger.log("destroy"),this.trigger(h["default"].DESTROYING),this.detachMedia(),this.playlistLoader.destroy(),this.fragmentLoader.destroy(),this.levelController.destroy(),this.abrController.destroy(),this.bufferController.destroy(),this.capLevelController.destroy(),this.fpsController.destroy(),this.streamController.destroy(),this.audioStreamController.destroy(),this.timelineController.destroy(),this.audioTrackController.destroy(),this.keyLoader.destroy(),this.url=null,this.observer.removeAllListeners()}},{key:"attachMedia",value:function(a){F.logger.log("attachMedia"),this.media=a,this.trigger(h["default"].MEDIA_ATTACHING,{media:a})}},{key:"detachMedia",value:function(){F.logger.log("detachMedia"),this.trigger(h["default"].MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(a){F.logger.log("loadSource:"+a),this.url=a,this.trigger(h["default"].MANIFEST_LOADING,{url:a})}},{key:"startLoad",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;F.logger.log("startLoad("+a+")"),this.levelController.startLoad(),this.streamController.startLoad(a),this.audioStreamController.startLoad(a)}},{key:"stopLoad",value:function(){F.logger.log("stopLoad"),this.levelController.stopLoad(),this.streamController.stopLoad(),this.audioStreamController.stopLoad()}},{key:"swapAudioCodec",value:function(){F.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){F.logger.log("recoverMediaError");var a=this.media;this.detachMedia(),this.attachMedia(a)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(a){F.logger.log("set currentLevel:"+a),this.loadLevel=a,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(a){F.logger.log("set nextLevel:"+a),this.levelController.manualLevel=a,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(a){F.logger.log("set loadLevel:"+a),this.levelController.manualLevel=a}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(a){this.levelController.nextLoadLevel=a}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.abrController.minAutoLevel)},set:function(a){F.logger.log("set firstLevel:"+a),this.levelController.firstLevel=a}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(a){F.logger.log("set startLevel:"+a),this.levelController.startLevel=a}},{key:"autoLevelCapping",get:function(){return this.abrController.autoLevelCapping},set:function(a){F.logger.log("set autoLevelCapping:"+a),this.abrController.autoLevelCapping=a}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"audioTracks",get:function(){return this.audioTrackController.audioTracks}},{key:"audioTrack",get:function(){return this.audioTrackController.audioTrack},set:function(a){this.audioTrackController.audioTrack=a}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}}]),a}();c["default"]=O},{1:1,10:10,11:11,12:12,13:13,26:26,28:28,34:34,35:35,36:36,4:4,43:43,45:45,47:47,5:5,6:6,7:7,8:8}],33:[function(a,b,c){"use strict";b.exports=a(32)["default"]},{32:32}],34:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(28),j=d(i),k=a(27),l=d(k),m=a(26),n=a(45),o=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].FRAG_LOADING));return c.loaders={},c}return g(b,a),h(b,[{key:"destroy",value:function(){var a=this.loaders;for(var b in a){var c=a[b];c&&c.destroy()}this.loaders={},l["default"].prototype.destroy.call(this)}},{key:"onFragLoading",value:function(a){var b=a.frag,c=b.type,d=this.loaders[c],e=this.hls.config;b.loaded=0,d&&(n.logger.warn("abort previous fragment loader for type:"+c),d.abort()),d=this.loaders[c]=b.loader="undefined"!=typeof e.fLoader?new e.fLoader(e):new e.loader(e);var f=void 0,g=void 0,h=void 0;f={url:b.url,frag:b,responseType:"arraybuffer",progressData:!1};var i=b.byteRangeStartOffset,j=b.byteRangeEndOffset;isNaN(i)||isNaN(j)||(f.rangeStart=i,f.rangeEnd=j),g={timeout:e.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:e.fragLoadingMaxRetryTimeout},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},d.load(f,g,h)}},{key:"loadsuccess",value:function(a,b,c){var d=a.data,e=c.frag;e.loader=void 0,this.loaders[e.type]=void 0,this.hls.trigger(j["default"].FRAG_LOADED,{payload:d,frag:e,stats:b})}},{key:"loaderror",value:function(a,b){var c=b.loader;c&&c.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:b.frag,response:a})}},{key:"loadtimeout",value:function(a,b){var c=b.loader;c&&c.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:b.frag})}},{key:"loadprogress",value:function(a,b,c){var d=b.frag;d.loaded=a.loaded,this.hls.trigger(j["default"].FRAG_LOAD_PROGRESS,{frag:d,stats:a})}}]),b}(l["default"]);c["default"]=o},{26:26,27:27,28:28,45:45}],35:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(28),j=d(i),k=a(27),l=d(k),m=a(26),n=a(45),o=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,j["default"].KEY_LOADING));return c.loaders={},c.decryptkey=null,c.decrypturl=null,c}return g(b,a),h(b,[{key:"destroy",value:function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},l["default"].prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(a){var b=a.frag,c=b.type,d=this.loaders[c],e=b.decryptdata,f=e.uri;if(f!==this.decrypturl||null===this.decryptkey){var g=this.hls.config;d&&(n.logger.warn("abort previous key loader for type:"+c),d.abort()),b.loader=this.loaders[c]=new g.loader(g),this.decrypturl=f,this.decryptkey=null;var h=void 0,i=void 0,k=void 0;h={url:f,frag:b,responseType:"arraybuffer"},i={timeout:g.fragLoadingTimeOut,maxRetry:g.fragLoadingMaxRetry,retryDelay:g.fragLoadingRetryDelay,maxRetryDelay:g.fragLoadingMaxRetryTimeout},k={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},b.loader.load(h,i,k)}else this.decryptkey&&(e.key=this.decryptkey,this.hls.trigger(j["default"].KEY_LOADED,{frag:b}))}},{key:"loadsuccess",value:function(a,b,c){var d=c.frag;this.decryptkey=d.decryptdata.key=new Uint8Array(a.data),d.loader=void 0,this.loaders[d.type]=void 0,this.hls.trigger(j["default"].KEY_LOADED,{frag:d})}},{key:"loaderror",value:function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:c,response:a})}},{key:"loadtimeout",value:function(a,b){var c=b.frag,d=c.loader;d&&d.abort(),this.loaders[b.type]=void 0,this.hls.trigger(j["default"].ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:c})}}]),b}(l["default"]);c["default"]=o},{26:26,27:27,28:28,45:45}],36:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=a(2),j=d(i),k=a(28),l=d(k),m=a(27),n=d(m),o=a(26),p=a(40),q=d(p),r=a(45),s=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,t=/#EXT-X-MEDIA:(.*)/g,u=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,v=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,w=function(){function a(){g(this,a),this.method=null,this.key=null,this.iv=null,this._uri=null}return h(a,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=j["default"].buildAbsoluteURL(this.baseuri,this.reluri)),this._uri}}]),a}(),x=function(){function a(){g(this,a),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return h(a,[{key:"createInitializationVector",value:function(a){for(var b=new Uint8Array(16),c=12;c<16;c++)b[c]=a>>8*(15-c)&255;return b}},{key:"fragmentDecryptdataFromLevelkey",value:function(a,b){var c=a;return a&&a.method&&a.uri&&!a.iv&&(c=new w,c.method=a.method,c.baseuri=a.baseuri,c.reluri=a.reluri,c.iv=this.createInitializationVector(b)),c}},{key:"cloneObj",value:function(a){return JSON.parse(JSON.stringify(a))}},{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=j["default"].buildAbsoluteURL(this.baseurl,this.relurl)),this._url},set:function(a){this._url=a}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var a=this._byteRange=[];if(this.rawByteRange){var b=this.rawByteRange.split("@",2);if(1===b.length){var c=this.lastByteRangeEndOffset;a[0]=c?c:0}else a[0]=parseInt(b[1]);a[1]=parseInt(b[0])+a[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),a}(),y=function(a){function b(a){g(this,b);var c=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,l["default"].MANIFEST_LOADING,l["default"].LEVEL_LOADING,l["default"].AUDIO_TRACK_LOADING));return c.loaders={},c}return f(b,a),h(b,[{key:"destroy",value:function(){for(var a in this.loaders){var b=this.loaders[a];b&&b.destroy()}this.loaders={},n["default"].prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(a){this.load(a.url,{type:"manifest"})}},{key:"onLevelLoading",value:function(a){this.load(a.url,{type:"level",level:a.level,id:a.id})}},{key:"onAudioTrackLoading",value:function(a){this.load(a.url,{type:"audioTrack",id:a.id})}},{key:"load",value:function(a,b){var c=this.loaders[b.type];if(c){var d=c.context;if(d&&d.url===a)return void r.logger.trace("playlist request ongoing");r.logger.warn("abort previous loader for type:"+b.type),c.abort()}var e=this.hls.config,f=void 0,g=void 0,h=void 0,i=void 0;"manifest"===b.type?(f=e.manifestLoadingMaxRetry,g=e.manifestLoadingTimeOut,h=e.manifestLoadingRetryDelay,i=e.manifestLoadingMaxRetryTimeout):(f=e.levelLoadingMaxRetry,g=e.levelLoadingTimeOut,h=e.levelLoadingRetryDelay,i=e.levelLoadingMaxRetryTimeout,r.logger.log("loading playlist for "+b.type+" "+(b.level||b.id))),c=this.loaders[b.type]=b.loader="undefined"!=typeof e.pLoader?new e.pLoader(e):new e.loader(e),b.url=a,b.responseType="";var j=void 0,k=void 0;j={timeout:g,maxRetry:f,retryDelay:h,maxRetryDelay:i},k={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},c.load(b,j,k)}},{key:"resolve",value:function(a,b){return j["default"].buildAbsoluteURL(b,a)}},{key:"parseMasterPlaylist",value:function(a,b){var c=[],d=void 0;for(s.lastIndex=0;null!=(d=s.exec(a));){var e={},f=e.attrs=new q["default"](d[1]);e.url=this.resolve(d[2],b);var g=f.decimalResolution("RESOLUTION");g&&(e.width=g.width,e.height=g.height),e.bitrate=f.decimalInteger("AVERAGE-BANDWIDTH")||f.decimalInteger("BANDWIDTH"),e.name=f.NAME;var h=f.CODECS;if(h){h=h.split(/[ ,]+/);for(var i=0;i<h.length;i++){var j=h[i];j.indexOf("avc1")!==-1?e.videoCodec=this.avc1toavcoti(j):e.audioCodec=j}}c.push(e)}return c}},{key:"parseMasterPlaylistMedia",value:function(a,b,c){var d=void 0,e=[];for(t.lastIndex=0;null!=(d=t.exec(a));){var f={},g=new q["default"](d[1]);g.TYPE===c&&(f.groupId=g["GROUP-ID"],f.name=g.NAME,f.type=c,f["default"]="YES"===g.DEFAULT,f.autoselect="YES"===g.AUTOSELECT,f.forced="YES"===g.FORCED,g.URI&&(f.url=this.resolve(g.URI,b)),f.lang=g.LANGUAGE,f.name||(f.name=f.lang),e.push(f))}return e}},{key:"avc1toavcoti",value:function(a){var b,c=a.split(".");return c.length>2?(b=c.shift()+".",b+=parseInt(c.shift()).toString(16),b+=("000"+parseInt(c.shift()).toString(16)).substr(-4)):b=a,b}},{key:"parseLevelPlaylist",value:function(a,b,c,d){var e,f,g=0,h=0,i={type:null,version:null,url:b,fragments:[],live:!0,startSN:0},j=new w,k=0,l=null,m=new x;for(u.lastIndex=0;null!==(e=u.exec(a));){var n=e[1];if(n){m.duration=parseFloat(n);var o=(" "+e[2]).slice(1);m.title=o?o:null,m.tagList.push(o?["INF",n,o]:["INF",n])}else if(e[3]){if(!isNaN(m.duration)){var p=g++;m.type=d,m.start=h,m.levelkey=j,m.sn=p,m.level=c,m.cc=k,m.baseurl=b,m.relurl=(" "+e[3]).slice(1),i.fragments.push(m),l=m,h+=m.duration,m=new x}}else if(e[4]){if(m.rawByteRange=(" "+e[4]).slice(1),l){var s=l.byteRangeEndOffset;s&&(m.lastByteRangeEndOffset=s)}}else if(e[5])m.rawProgramDateTime=(" "+e[5]).slice(1),m.tagList.push(["PROGRAM-DATE-TIME",m.rawProgramDateTime]);else{for(e=e[0].match(v),f=1;f<e.length&&void 0===e[f];f++);var t=(" "+e[f+1]).slice(1),y=(" "+e[f+2]).slice(1);switch(e[f]){case"#":m.tagList.push(y?[t,y]:[t]);break;case"PLAYLIST-TYPE":i.type=t.toUpperCase();break;case"MEDIA-SEQUENCE":g=i.startSN=parseInt(t);break;case"TARGETDURATION":i.targetduration=parseFloat(t);break;case"VERSION":i.version=parseInt(t);break;case"EXTM3U":break;case"ENDLIST":i.live=!1;break;case"DIS":k++,m.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":k=parseInt(t);break;case"KEY":var z=t,A=new q["default"](z),B=A.enumeratedString("METHOD"),C=A.URI,D=A.hexadecimalInteger("IV");B&&(j=new w,C&&"AES-128"===B&&(j.method=B,j.baseuri=b,j.reluri=C,j.key=null,j.iv=D));break;case"START":var E=t,F=new q["default"](E),G=F.decimalFloatingPoint("TIME-OFFSET");isNaN(G)||(i.startTimeOffset=G);break;case"MAP":var H=new q["default"](t);m.relurl=H.URI,m.rawByteRange=H.BYTERANGE,m.baseurl=b,m.level=c,m.type=d,m.sn="initSegment",i.initSegment=m,m=new x;break;default:r.logger.warn("line parsed but not handled: "+e)}}}return m=l,m&&!m.relurl&&(i.fragments.pop(),h-=m.duration),i.totalduration=h,i.averagetargetduration=h/i.fragments.length,i.endSN=g-1,i}},{key:"loadsuccess",value:function(a,b,c){var d=a.data,e=a.url,f=c.type,g=c.id,h=c.level,i=this.hls;if(this.loaders[f]=void 0,void 0!==e&&0!==e.indexOf("data:")||(e=c.url),b.tload=performance.now(),0===d.indexOf("#EXTM3U"))if(d.indexOf("#EXTINF:")>0){var j="audioTrack"!==f,k=this.parseLevelPlaylist(d,e,(j?h:g)||0,j?"main":"audio");"manifest"===f&&i.trigger(l["default"].MANIFEST_LOADED,{levels:[{url:e,details:k}],audioTracks:[],url:e,stats:b}),b.tparsed=performance.now(),k.targetduration?j?i.trigger(l["default"].LEVEL_LOADED,{details:k,level:h||0,id:g||0,stats:b}):i.trigger(l["default"].AUDIO_TRACK_LOADED,{details:k,id:g,stats:b}):i.trigger(l["default"].ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e,reason:"invalid targetduration"})}else{var m=this.parseMasterPlaylist(d,e);if(m.length){var n=this.parseMasterPlaylistMedia(d,e,"AUDIO");if(n.length){var p=!1;n.forEach(function(a){a.url||(p=!0)}),p===!1&&m[0].audioCodec&&!m[0].attrs.AUDIO&&(r.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),n.unshift({type:"main",name:"main"}))}i.trigger(l["default"].MANIFEST_LOADED,{levels:m,audioTracks:n,url:e,stats:b})}else i.trigger(l["default"].ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e,reason:"no level found in manifest"})}else i.trigger(l["default"].ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(a,b){var c,d,e=b.loader;switch(b.type){case"manifest":c=o.ErrorDetails.MANIFEST_LOAD_ERROR,d=!0;break;case"level":c=o.ErrorDetails.LEVEL_LOAD_ERROR,d=!1;break;case"audioTrack":c=o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,d=!1}e&&(e.abort(),this.loaders[b.type]=void 0),this.hls.trigger(l["default"].ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:c,fatal:d,url:e.url,loader:e,response:a,context:b})}},{key:"loadtimeout",value:function(a,b){var c,d,e=b.loader;switch(b.type){case"manifest":c=o.ErrorDetails.MANIFEST_LOAD_TIMEOUT,d=!0;break;case"level":c=o.ErrorDetails.LEVEL_LOAD_TIMEOUT,d=!1;break;case"audioTrack":c=o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,d=!1}e&&(e.abort(),this.loaders[b.type]=void 0),this.hls.trigger(l["default"].ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:c,fatal:d,url:e.url,loader:e,context:b})}}]),b}(n["default"]);c["default"]=y},{2:2,26:26,27:27,28:28,40:40,45:45}],37:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a)}return e(a,null,[{key:"init",value:function(){a.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var b;for(b in a.types)a.types.hasOwnProperty(b)&&(a.types[b]=[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]);var c=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);a.HDLR_TYPES={video:c,audio:d};var e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);a.STTS=a.STSC=a.STCO=f,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),h=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);a.FTYP=a.box(a.types.ftyp,g,i,g,h),a.DINF=a.box(a.types.dinf,a.box(a.types.dref,e))}},{key:"box",value:function(a){for(var b,c=Array.prototype.slice.call(arguments,1),d=8,e=c.length,f=e;e--;)d+=c[e].byteLength;for(b=new Uint8Array(d),b[0]=d>>24&255,b[1]=d>>16&255,b[2]=d>>8&255,b[3]=255&d,b.set(a,4),e=0,d=8;e<f;e++)b.set(c[e],d),d+=c[e].byteLength;return b;
}},{key:"hdlr",value:function(b){return a.box(a.types.hdlr,a.HDLR_TYPES[b])}},{key:"mdat",value:function(b){return a.box(a.types.mdat,b)}},{key:"mdhd",value:function(b,c){return c*=b,a.box(a.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,b>>24&255,b>>16&255,b>>8&255,255&b,c>>24,c>>16&255,c>>8&255,255&c,85,196,0,0]))}},{key:"mdia",value:function(b){return a.box(a.types.mdia,a.mdhd(b.timescale,b.duration),a.hdlr(b.type),a.minf(b))}},{key:"mfhd",value:function(b){return a.box(a.types.mfhd,new Uint8Array([0,0,0,0,b>>24,b>>16&255,b>>8&255,255&b]))}},{key:"minf",value:function(b){return"audio"===b.type?a.box(a.types.minf,a.box(a.types.smhd,a.SMHD),a.DINF,a.stbl(b)):a.box(a.types.minf,a.box(a.types.vmhd,a.VMHD),a.DINF,a.stbl(b))}},{key:"moof",value:function(b,c,d){return a.box(a.types.moof,a.mfhd(b),a.traf(d,c))}},{key:"moov",value:function(b){for(var c=b.length,d=[];c--;)d[c]=a.trak(b[c]);return a.box.apply(null,[a.types.moov,a.mvhd(b[0].timescale,b[0].duration)].concat(d).concat(a.mvex(b)))}},{key:"mvex",value:function(b){for(var c=b.length,d=[];c--;)d[c]=a.trex(b[c]);return a.box.apply(null,[a.types.mvex].concat(d))}},{key:"mvhd",value:function(b,c){c*=b;var d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,b>>24&255,b>>16&255,b>>8&255,255&b,c>>24&255,c>>16&255,c>>8&255,255&c,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return a.box(a.types.mvhd,d)}},{key:"sdtp",value:function(b){var c,d,e=b.samples||[],f=new Uint8Array(4+e.length);for(d=0;d<e.length;d++)c=e[d].flags,f[d+4]=c.dependsOn<<4|c.isDependedOn<<2|c.hasRedundancy;return a.box(a.types.sdtp,f)}},{key:"stbl",value:function(b){return a.box(a.types.stbl,a.stsd(b),a.box(a.types.stts,a.STTS),a.box(a.types.stsc,a.STSC),a.box(a.types.stsz,a.STSZ),a.box(a.types.stco,a.STCO))}},{key:"avc1",value:function(b){var c,d,e,f=[],g=[];for(c=0;c<b.sps.length;c++)d=b.sps[c],e=d.byteLength,f.push(e>>>8&255),f.push(255&e),f=f.concat(Array.prototype.slice.call(d));for(c=0;c<b.pps.length;c++)d=b.pps[c],e=d.byteLength,g.push(e>>>8&255),g.push(255&e),g=g.concat(Array.prototype.slice.call(d));var h=a.box(a.types.avcC,new Uint8Array([1,f[3],f[4],f[5],255,224|b.sps.length].concat(f).concat([b.pps.length]).concat(g))),i=b.width,j=b.height,k=b.pixelRatio[0],l=b.pixelRatio[1];return a.box(a.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,j>>8&255,255&j,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),h,a.box(a.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),a.box(a.types.pasp,new Uint8Array([k>>24,k>>16&255,k>>8&255,255&k,l>>24,l>>16&255,l>>8&255,255&l])))}},{key:"esds",value:function(a){var b=a.config.length;return new Uint8Array([0,0,0,0,3,23+b,0,1,0,4,15+b,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([b]).concat(a.config).concat([6,1,2]))}},{key:"mp4a",value:function(b){var c=b.audiosamplerate;return a.box(a.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]),a.box(a.types.esds,a.esds(b)))}},{key:"mp3",value:function(b){var c=b.audiosamplerate;return a.box(a.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,b.channelCount,0,16,0,0,0,0,c>>8&255,255&c,0,0]))}},{key:"stsd",value:function(b){return"audio"===b.type?b.isAAC||"mp3"!==b.codec?a.box(a.types.stsd,a.STSD,a.mp4a(b)):a.box(a.types.stsd,a.STSD,a.mp3(b)):a.box(a.types.stsd,a.STSD,a.avc1(b))}},{key:"tkhd",value:function(b){var c=b.id,d=b.duration*b.timescale,e=b.width,f=b.height;return a.box(a.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,c>>24&255,c>>16&255,c>>8&255,255&c,0,0,0,0,d>>24,d>>16&255,d>>8&255,255&d,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,e>>8&255,255&e,0,0,f>>8&255,255&f,0,0]))}},{key:"traf",value:function(b,c){var d=a.sdtp(b),e=b.id;return a.box(a.types.traf,a.box(a.types.tfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e])),a.box(a.types.tfdt,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c])),a.trun(b,d.length+16+16+8+16+8+8),d)}},{key:"trak",value:function(b){return b.duration=b.duration||4294967295,a.box(a.types.trak,a.tkhd(b),a.mdia(b))}},{key:"trex",value:function(b){var c=b.id;return a.box(a.types.trex,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(b,c){var d,e,f,g,h,i,j=b.samples||[],k=j.length,l=12+16*k,m=new Uint8Array(l);for(c+=8+l,m.set([0,0,15,1,k>>>24&255,k>>>16&255,k>>>8&255,255&k,c>>>24&255,c>>>16&255,c>>>8&255,255&c],0),d=0;d<k;d++)e=j[d],f=e.duration,g=e.size,h=e.flags,i=e.cts,m.set([f>>>24&255,f>>>16&255,f>>>8&255,255&f,g>>>24&255,g>>>16&255,g>>>8&255,255&g,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,i>>>24&255,i>>>16&255,i>>>8&255,255&i],12+16*d);return a.box(a.types.trun,m)}},{key:"initSegment",value:function(b){a.types||a.init();var c,d=a.moov(b);return c=new Uint8Array(a.FTYP.byteLength+d.byteLength),c.set(a.FTYP),c.set(d,a.FTYP.byteLength),c}}]),a}();c["default"]=f},{}],38:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(29),h=d(g),i=a(28),j=d(i),k=a(45),l=a(37),m=d(l),n=a(26),o=function(){function a(b,c,d,f){e(this,a),this.observer=b,this.id=c,this.config=d,this.typeSupported=f,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}return f(a,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(a,b,c,d,e,f,g,h,i,k,l){if(this.level=a,this.sn=b,this.ISGenerated||this.generateIS(d,e,h,c),null!==l&&(this._initPTS=this._initDTS=l),this.ISGenerated)if(d.samples.length){var m=this.remuxAudio(d,h,i,k);if(e.samples.length){var n=void 0;m&&(n=m.endPTS-m.startPTS),this.remuxVideo(e,h,i,n)}}else{var o=void 0;e.samples.length&&(o=this.remuxVideo(e,h,i)),o&&d.codec&&this.remuxEmptyAudio(d,h,i,o)}f.samples.length&&this.remuxID3(f,h),g.samples.length&&this.remuxText(g,h),this.observer.trigger(j["default"].FRAG_PARSED,{id:this.id,level:this.level,sn:this.sn})}},{key:"generateIS",value:function(a,b,c,d){var e,f,g=this.observer,h=a.samples,i=b.samples,l=this.PES_TIMESCALE,o=this.typeSupported,p="audio/mp4",q={},r={id:this.id,level:this.level,sn:this.sn,tracks:q,unique:!1},s=void 0===this._initPTS;s&&(e=f=1/0),a.config&&h.length&&(a.timescale=a.audiosamplerate,a.timescale*a.duration>Math.pow(2,32)&&!function(){var b=function c(a,b){return b?c(b,a%b):a};a.timescale=a.audiosamplerate/b(a.audiosamplerate,a.isAAC?1024:1152)}(),k.logger.log("audio mp4 timescale :"+a.timescale),a.isAAC||(o.mpeg?(p="audio/mpeg",a.codec=""):o.mp3&&(a.codec="mp3")),q.audio={container:p,codec:a.codec,initSegment:!a.isAAC&&o.mpeg?new Uint8Array:m["default"].initSegment([a]),metadata:{channelCount:a.channelCount}},s&&(e=f=h[0].pts-l*c)),b.sps&&b.pps&&i.length&&(b.timescale=this.MP4_TIMESCALE,q.video={container:"video/mp4",codec:b.codec,initSegment:m["default"].initSegment([b]),metadata:{width:b.width,height:b.height}},s&&(e=Math.min(e,i[0].pts-l*c),f=Math.min(f,i[0].dts-l*c),this.observer.trigger(j["default"].INIT_PTS_FOUND,{id:this.id,initPTS:e,cc:d}))),Object.keys(q).length?(g.trigger(j["default"].FRAG_PARSING_INIT_SEGMENT,r),this.ISGenerated=!0,s&&(this._initPTS=e,this._initDTS=f)):g.trigger(j["default"].ERROR,{type:n.ErrorTypes.MEDIA_ERROR,id:this.id,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(a,b,c,d){var e,f,g,h,i,l,o,p,q=8,r=this.PES_TIMESCALE,s=this.PES2MP4SCALEFACTOR,t=a.samples,u=[],v=t.length,w=this._PTSNormalize,x=this._initDTS;t.sort(function(a,b){var c=a.dts-b.dts;return c?c:a.pts-b.pts});var y=t.reduce(function(a,b){return Math.max(Math.min(a,b.pts-b.dts),-18e3)},0);if(y<0){k.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(y/90)+" ms to overcome this issue");for(var z=0;z<t.length;z++)t[z].dts+=y}var A=void 0;A=c?this.nextAvcDts:b*r;var B=t[0];i=Math.max(w(B.dts-x,A),0),h=Math.max(w(B.pts-x,A),0);var C=Math.round((i-A)/90);c&&C&&(C>1?k.logger.log("AVC:"+C+" ms hole between fragments detected,filling it"):C<-1&&k.logger.log("AVC:"+-C+" ms overlapping between fragments detected"),i=A,t[0].dts=i+x,h=Math.max(h-C,A),t[0].pts=h+x,k.logger.log("Video/PTS/DTS adjusted: "+Math.round(h/90)+"/"+Math.round(i/90)+",delta:"+C+" ms")),l=i,B=t[t.length-1],p=Math.max(w(B.dts-x,A),0),o=Math.max(w(B.pts-x,A),0),o=Math.max(o,p);var D=navigator.vendor,E=navigator.userAgent,F=D&&D.indexOf("Apple")>-1&&E&&!E.match("CriOS");F&&(e=Math.round((p-i)/(s*(t.length-1))));for(var G=0;G<v;G++){var H=t[G];F?H.dts=i+G*s*e:(H.dts=Math.max(w(H.dts-x,A),i),H.dts=Math.round(H.dts/s)*s),H.pts=Math.max(w(H.pts-x,A),H.dts),H.pts=Math.round(H.pts/s)*s}var I=a.len+4*a.nbNalu+8;try{f=new Uint8Array(I)}catch(J){return void this.observer.trigger(j["default"].ERROR,{type:n.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:n.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:I,reason:"fail allocating video mdat "+I})}var K=new DataView(f.buffer);K.setUint32(0,I),f.set(m["default"].types.mdat,4);for(var L=0;L<v;L++){for(var M=t[L],N=M.units.units,O=0,P=void 0,Q=0,R=N.length;Q<R;Q++){var S=N[Q],T=S.data,U=S.data.byteLength;K.setUint32(q,U),q+=4,f.set(T,q),q+=U,O+=4+U}if(F)P=Math.max(0,e*Math.round((M.pts-M.dts)/(s*e)));else{if(L<v-1)e=t[L+1].dts-M.dts;else{var V=this.config,W=M.dts-t[L>0?L-1:L].dts;if(V.stretchShortVideoTrack){var X=V.maxBufferHole,Y=V.maxSeekHole,Z=Math.floor(Math.min(X,Y)*r),$=(d?h+d*r:this.nextAudioPts)-M.pts;$>Z?(e=$-W,e<0&&(e=W),k.logger.log("It is approximately "+$/90+" ms to the next segment; using duration "+e/90+" ms for the last video frame.")):e=W}else e=W}e/=s,P=Math.round((M.pts-M.dts)/s)}u.push({size:O,duration:e,cts:P,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:M.key?2:1,isNonSync:M.key?0:1}})}this.nextAvcDts=p+e*s;var _=a.dropped;if(a.len=0,a.nbNalu=0,a.dropped=0,u.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var aa=u[0].flags;aa.dependsOn=2,aa.isNonSync=0}a.samples=u,g=m["default"].moof(a.sequenceNumber++,i/s,a),a.samples=[];var ba={id:this.id,level:this.level,sn:this.sn,data1:g,data2:f,startPTS:h/r,endPTS:(o+s*e)/r,startDTS:i/r,endDTS:this.nextAvcDts/r,type:"video",nb:u.length,dropped:_};return this.observer.trigger(j["default"].FRAG_PARSING_DATA,ba),ba}},{key:"remuxAudio",value:function(a,b,c,d){var e,f,g,i,l,o,p,q,r,s,t,u,v,w,x,y,z=this.PES_TIMESCALE,A=a.timescale,B=z/A,C=a.timescale*(a.isAAC?1024:1152)/a.audiosamplerate,D=C*B,E=this._PTSNormalize,F=this._initDTS,G=!a.isAAC&&this.typeSupported.mpeg,H=G?0:8,I=[],J=[];if(a.samples.sort(function(a,b){return a.pts-b.pts}),J=a.samples,y=this.nextAudioPts,c|=J.length&&y&&(Math.abs(b-y/z)<.1||Math.abs(J[0].pts-y-this._initDTS)<20*D),c||(y=b*z),d&&a.isAAC)for(var K=0,L=y;K<J.length;){var M=J[K],N=E(M.pts-F,y),O=N-L;if(O<=-D)k.logger.warn("Dropping 1 audio frame @ "+Math.round(L/90)/1e3+"s due to "+Math.round(Math.abs(O/90))+" ms overlap."),J.splice(K,1),a.len-=M.unit.length;else if(O>=D&&L){var P=Math.round(O/D);k.logger.warn("Injecting "+P+" audio frame @ "+Math.round(L/90)/1e3+"s due to "+Math.round(O/90)+" ms gap.");for(var Q=0;Q<P;Q++)x=L+F,x=Math.max(x,F),w=h["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount),w||(k.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),w=M.unit.subarray()),J.splice(K,0,{unit:w,pts:x,dts:x}),a.len+=w.length,L+=D,K+=1;M.pts=M.dts=L+F,L+=D,K+=1}else Math.abs(O)>.1*D,L+=D,0===K?M.pts=M.dts=F+y:M.pts=M.dts=J[K-1].pts+D,K+=1}for(var R=0,S=J.length;R<S;R++){if(f=J[R],i=f.unit,s=f.pts-F,t=f.dts-F,void 0!==r)u=E(s,r),v=E(t,r),g.duration=Math.round((v-r)/B);else{u=E(s,y),v=E(t,y);var T=Math.round(1e3*(u-y)/z),U=0;if(c&&a.isAAC&&T){if(T>0)U=Math.round((u-y)/D),k.logger.log(T+" ms hole between AAC samples detected,filling it"),U>0&&(w=h["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount),w||(w=i.subarray()),a.len+=U*w.length);else if(T<-12){k.logger.log(-T+" ms overlapping between AAC samples detected, drop frame"),a.len-=i.byteLength;continue}u=v=y}if(p=Math.max(0,u),q=Math.max(0,v),!(a.len>0))return;var V=G?a.len:a.len+8;try{l=new Uint8Array(V)}catch(W){return void this.observer.trigger(j["default"].ERROR,{type:n.ErrorTypes.MUX_ERROR,level:this.level,id:this.id,details:n.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:V,reason:"fail allocating audio mdat "+V})}G||(e=new DataView(l.buffer),e.setUint32(0,V),l.set(m["default"].types.mdat,4));for(var X=0;X<U;X++)x=u-(U-X)*D,w=h["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount),w||(k.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),w=i.subarray()),l.set(w,H),H+=w.byteLength,g={size:w.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},I.push(g)}l.set(i,H);var Y=i.byteLength;H+=Y,g={size:Y,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},I.push(g),r=v}var Z=0,$=I.length;if($>=2&&(Z=I[$-2].duration,g.duration=Z),$){this.nextAudioPts=u+B*Z,a.len=0,a.samples=I,o=G?new Uint8Array:m["default"].moof(a.sequenceNumber++,q/B,a),a.samples=[];var _={id:this.id,level:this.level,sn:this.sn,data1:o,data2:l,startPTS:p/z,endPTS:this.nextAudioPts/z,startDTS:q/z,endDTS:(v+B*Z)/z,type:"audio",nb:$};return this.observer.trigger(j["default"].FRAG_PARSING_DATA,_),_}return null}},{key:"remuxEmptyAudio",value:function(a,b,c,d){var e=this.PES_TIMESCALE,f=a.timescale?a.timescale:a.audiosamplerate,g=e/f,i=this.nextAudioPts,j=(void 0!==i?i:d.startDTS*e)+this._initDTS,l=d.endDTS*e+this._initDTS,m=1024,n=g*m,o=Math.ceil((l-j)/n),p=h["default"].getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(k.logger.warn("remux empty Audio"),!p)return void k.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var q=[],r=0;r<o;r++){var s=j+r*n;q.push({unit:p,pts:s,dts:s}),a.len+=p.length}a.samples=q,this.remuxAudio(a,b,c)}},{key:"remuxID3",value:function(a,b){var c,d=a.samples.length;if(d){for(var e=0;e<d;e++)c=a.samples[e],c.pts=(c.pts-this._initPTS)/this.PES_TIMESCALE,c.dts=(c.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(j["default"].FRAG_PARSING_METADATA,{id:this.id,level:this.level,sn:this.sn,samples:a.samples})}a.samples=[],b=b}},{key:"remuxText",value:function(a,b){a.samples.sort(function(a,b){return a.pts-b.pts});var c,d=a.samples.length;if(d){for(var e=0;e<d;e++)c=a.samples[e],c.pts=(c.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(j["default"].FRAG_PARSING_USERDATA,{id:this.id,level:this.level,sn:this.sn,samples:a.samples})}a.samples=[],b=b}},{key:"_PTSNormalize",value:function(a,b){var c;if(void 0===b)return a;for(c=b<a?-8589934592:8589934592;Math.abs(a-b)>4294967296;)a+=c;return a}},{key:"passthrough",get:function(){return!1}}]),a}();c["default"]=o},{26:26,28:28,29:29,37:37,45:45}],39:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a(28),h=d(g),i=function(){function a(b,c){e(this,a),this.observer=b,this.id=c,this.ISGenerated=!1}return f(a,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(a,b,c,d,e,f){var g=this.observer;if(!this.ISGenerated){var i={},j={id:this.id,tracks:i,unique:!0},k=b,l=k.codec;l&&(j.tracks.video={container:k.container,codec:l,metadata:{width:k.width,height:k.height}}),k=a,l=k.codec,l&&(j.tracks.audio={container:k.container,codec:l,metadata:{channelCount:k.channelCount}}),this.ISGenerated=!0,g.trigger(h["default"].FRAG_PARSING_INIT_SEGMENT,j)}g.trigger(h["default"].FRAG_PARSING_DATA,{id:this.id,data1:f,startPTS:e,startDTS:e,type:"audiovideo",nb:1,dropped:0})}},{key:"passthrough",get:function(){return!0}}]),a}();c["default"]=i},{28:28}],40:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=/^(\d+)x(\d+)$/,g=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,h=function(){function a(b){d(this,a),"string"==typeof b&&(b=a.parseAttrList(b));for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])}return e(a,[{key:"decimalInteger",value:function(a){var b=parseInt(this[a],10);return b>Number.MAX_SAFE_INTEGER?1/0:b}},{key:"hexadecimalInteger",value:function(a){if(this[a]){var b=(this[a]||"0x").slice(2);b=(1&b.length?"0":"")+b;for(var c=new Uint8Array(b.length/2),d=0;d<b.length/2;d++)c[d]=parseInt(b.slice(2*d,2*d+2),16);return c}return null}},{key:"hexadecimalIntegerAsNumber",value:function(a){var b=parseInt(this[a],16);return b>Number.MAX_SAFE_INTEGER?1/0:b}},{key:"decimalFloatingPoint",value:function(a){return parseFloat(this[a])}},{key:"enumeratedString",value:function(a){return this[a]}},{key:"decimalResolution",value:function(a){var b=f.exec(this[a]);if(null!==b)return{width:parseInt(b[1],10),height:parseInt(b[2],10)}}}],[{key:"parseAttrList",value:function(a){var b,c={};for(g.lastIndex=0;null!==(b=g.exec(a));){var d=b[2],e='"';0===d.indexOf(e)&&d.lastIndexOf(e)===d.length-1&&(d=d.slice(1,-1)),c[b[1]]=d}return c}}]),a}();c["default"]=h},{}],41:[function(a,b,c){"use strict";var d={search:function(a,b){for(var c=0,d=a.length-1,e=null,f=null;c<=d;){e=(c+d)/2|0,f=a[e];var g=b(f);if(g>0)c=e+1;else{if(!(g<0))return f;d=e-1}}return null}};b.exports=d},{}],42:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},g=function(a){var b=a;return f.hasOwnProperty(a)&&(b=f[a]),String.fromCharCode(b)},h=15,i=32,j={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},k={17:2,18:4,21:6,22:8,23:10,19:13,20:15},l={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},m={25:2,26:4,29:6,30:8,31:10,27:13,28:15},n=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],o={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(a){this.time=a},log:function(a,b){var c=this.verboseFilter[a];this.verboseLevel>=c}},p=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].toString(16));return b},q=function(){function a(b,c,e,f,g){d(this,a),this.foreground=b||"white",this.underline=c||!1,this.italics=e||!1,this.background=f||"black",this.flash=g||!1}return e(a,[{key:"reset",value:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}},{key:"setStyles",value:function(a){for(var b=["foreground","underline","italics","background","flash"],c=0;c<b.length;c++){var d=b[c];a.hasOwnProperty(d)&&(this[d]=a[d])}}},{key:"isDefault",value:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}},{key:"equals",value:function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash}},{key:"copy",value:function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash}},{key:"toString",value:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}]),a}(),r=function(){function a(b,c,e,f,g,h){d(this,a),this.uchar=b||" ",this.penState=new q(c,e,f,g,h)}return e(a,[{key:"reset",value:function(){this.uchar=" ",this.penState.reset()}},{key:"setChar",value:function(a,b){this.uchar=a,this.penState.copy(b)}},{key:"setPenState",value:function(a){this.penState.copy(a)}},{key:"equals",value:function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)}},{key:"copy",value:function(a){this.uchar=a.uchar,this.penState.copy(a.penState)}},{key:"isEmpty",value:function(){return" "===this.uchar&&this.penState.isDefault()}}]),a}(),s=function(){function a(){d(this,a),this.chars=[];for(var b=0;b<i;b++)this.chars.push(new r);this.pos=0,this.currPenState=new q}return e(a,[{key:"equals",value:function(a){for(var b=!0,c=0;c<i;c++)if(!this.chars[c].equals(a.chars[c])){b=!1;break}return b}},{key:"copy",value:function(a){for(var b=0;b<i;b++)this.chars[b].copy(a.chars[b])}},{key:"isEmpty",value:function(){for(var a=!0,b=0;b<i;b++)if(!this.chars[b].isEmpty()){a=!1;break}return a}},{key:"setCursor",value:function(a){this.pos!==a&&(this.pos=a),this.pos<0?(o.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>i&&(o.log("ERROR","Too large cursor position "+this.pos),this.pos=i)}},{key:"moveCursor",value:function(a){var b=this.pos+a;if(a>1)for(var c=this.pos+1;c<b+1;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(b)}},{key:"backSpace",value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}},{key:"insertChar",value:function(a){a>=144&&this.backSpace();var b=g(a);return this.pos>=i?void o.log("ERROR","Cannot insert "+a.toString(16)+" ("+b+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(b,this.currPenState),void this.moveCursor(1))}},{key:"clearFromPos",value:function(a){var b;for(b=a;b<i;b++)this.chars[b].reset()}},{key:"clear",value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}},{key:"clearToEndOfRow",value:function(){this.clearFromPos(this.pos)}},{key:"getTextString",value:function(){for(var a=[],b=!0,c=0;c<i;c++){var d=this.chars[c].uchar;" "!==d&&(b=!1),a.push(d)}return b?"":a.join("")}},{key:"setPenStyles",value:function(a){this.currPenState.setStyles(a);var b=this.chars[this.pos];b.setPenState(this.currPenState)}}]),a}(),t=function(){function a(){d(this,a),this.rows=[];for(var b=0;b<h;b++)this.rows.push(new s);this.currRow=h-1,this.nrRollUpRows=null,this.reset()}return e(a,[{key:"reset",value:function(){for(var a=0;a<h;a++)this.rows[a].clear();this.currRow=h-1}},{key:"equals",value:function(a){for(var b=!0,c=0;c<h;c++)if(!this.rows[c].equals(a.rows[c])){b=!1;break}return b}},{key:"copy",value:function(a){for(var b=0;b<h;b++)this.rows[b].copy(a.rows[b])}},{key:"isEmpty",value:function(){for(var a=!0,b=0;b<h;b++)if(!this.rows[b].isEmpty()){a=!1;break}return a}},{key:"backSpace",value:function(){var a=this.rows[this.currRow];a.backSpace()}},{key:"clearToEndOfRow",value:function(){var a=this.rows[this.currRow];a.clearToEndOfRow()}},{key:"insertChar",value:function(a){var b=this.rows[this.currRow];b.insertChar(a)}},{key:"setPen",value:function(a){var b=this.rows[this.currRow];b.setPenStyles(a)}},{key:"moveCursor",value:function(a){var b=this.rows[this.currRow];b.moveCursor(a)}},{key:"setCursor",value:function(a){o.log("INFO","setCursor: "+a);var b=this.rows[this.currRow];b.setCursor(a)}},{key:"setPAC",value:function(a,b){o.log("INFO","pacData = "+JSON.stringify(a));var c=a.row-1;if(this.nrRollUpRows&&c<this.nrRollUpRows-1&&(c=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==c){for(var d=0;d<h;d++)this.rows[d].clear();var e=this.currRow+1-this.nrRollUpRows,f=b.rows[e].cueStartTime;if(f&&f<o.time)for(d=0;d<this.nrRollUpRows;d++)this.rows[c-this.nrRollUpRows+d+1].copy(b.rows[e+d])}this.currRow=c;var g=this.rows[this.currRow];if(null!==a.indent){var i=a.indent,j=Math.max(i-1,0);g.setCursor(a.indent),a.color=g.chars[j].penState.foreground}var k={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(k)}},{key:"setBkgData",value:function(a){o.log("INFO","bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)}},{key:"setRollUpRows",value:function(a){this.nrRollUpRows=a}},{key:"rollUp",value:function(){if(null===this.nrRollUpRows)return void o.log("DEBUG","roll_up but nrRollUpRows not set yet");o.log("TEXT",this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,b=this.rows.splice(a,1)[0];b.clear(),this.rows.splice(this.currRow,0,b),o.log("INFO","Rolling up")}},{key:"getDisplayText",value:function(a){a=a||!1;for(var b=[],c="",d=-1,e=0;e<h;e++){var f=this.rows[e].getTextString();f&&(d=e+1,a?b.push("Row "+d+": '"+f+"'"):b.push(f.trim()))}return b.length>0&&(c=a?"["+b.join(" | ")+"]":b.join("\n")),c}},{key:"getTextAndFormat",value:function(){return this.rows}}]),a}(),u=function(){function a(b,c){d(this,a),this.chNr=b,this.outputFilter=c,this.mode=null,this.verbose=0,this.displayedMemory=new t,this.nonDisplayedMemory=new t,this.lastOutputScreen=new t,this.currRollUpRow=this.displayedMemory.rows[h-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return e(a,[{key:"reset",value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[h-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null}},{key:"getHandler",value:function(){return this.outputFilter}},{key:"setHandler",value:function(a){this.outputFilter=a}},{key:"setPAC",value:function(a){this.writeScreen.setPAC(a,this.lastOutputScreen)}},{key:"setBkgData",value:function(a){this.writeScreen.setBkgData(a)}},{key:"setMode",value:function(a){a!==this.mode&&(this.mode=a,o.log("INFO","MODE="+a),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset(),this.lastOutputScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)}},{key:"insertChars",value:function(a){for(var b=0;b<a.length;b++)this.writeScreen.insertChar(a[b]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";o.log("INFO",c+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(o.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}},{key:"ccRCL",value:function(){o.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}},{key:"ccBS",value:function(){o.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}},{key:"ccAOF",value:function(){}},{key:"ccAON",value:function(){}},{key:"ccDER",value:function(){o.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}},{key:"ccRU",value:function(a){o.log("INFO","RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)}},{key:"ccFON",value:function(){o.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})}},{key:"ccRDC",value:function(){o.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}},{key:"ccTR",value:function(){o.log("INFO","TR"),this.setMode("MODE_TEXT")}},{key:"ccRTD",value:function(){o.log("INFO","RTD"),this.setMode("MODE_TEXT")}},{key:"ccEDM",value:function(){o.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()}},{key:"ccCR",value:function(){o.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()}},{key:"ccENM",value:function(){o.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}},{key:"ccEOC",value:function(){if(o.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,o.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()}},{key:"ccTO",value:function(a){o.log("INFO","TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)}},{key:"ccMIDROW",value:function(a){var b={flash:!1};if(b.underline=a%2===1,b.italics=a>=46,b.italics)b.foreground="white";else{var c=Math.floor(a/2)-16,d=["white","green","blue","cyan","red","yellow","magenta"];b.foreground=d[c]}o.log("INFO","MIDROW: "+JSON.stringify(b)),this.writeScreen.setPen(b)}},{key:"outputDataUpdate",value:function(){var a=o.time;null!==a&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(a,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:a):this.cueStartTime=a,this.lastOutputScreen.copy(this.displayedMemory))}},{key:"cueSplitAtTime",value:function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))}}]),a}(),v=function(){function a(b,c,e){d(this,a),this.field=b||1,this.outputs=[c,e],this.channels=[new u(1,c),new u(2,e)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,"char":0,cmd:0,other:0}}return e(a,[{key:"getHandler",value:function(a){return this.channels[a].getHandler()}},{key:"setHandler",value:function(a,b){this.channels[a].setHandler(b)}},{key:"addData",value:function(a,b){var c,d,e,f=!1;this.lastTime=a,o.setTime(a);for(var g=0;g<b.length;g+=2)if(d=127&b[g],e=127&b[g+1],0!==d||0!==e){if(o.log("DATA","["+p([b[g],b[g+1]])+"] -> ("+p([d,e])+")"),c=this.parseCmd(d,e),c||(c=this.parseMidrow(d,e)),c||(c=this.parsePAC(d,e)),c||(c=this.parseBackgroundAttributes(d,e)),!c&&(f=this.parseChars(d,e)))if(this.currChNr&&this.currChNr>=0){var h=this.channels[this.currChNr-1];h.insertChars(f)}else o.log("WARNING","No channel found yet. TEXT-MODE?");
c?this.dataCounters.cmd+=2:f?this.dataCounters["char"]+=2:(this.dataCounters.other+=2,o.log("WARNING","Couldn't parse cleaned data "+p([d,e])+" orig: "+p([b[g],b[g+1]])))}else this.dataCounters.padding+=2}},{key:"parseCmd",value:function(a,b){var c=null,d=(20===a||28===a)&&32<=b&&b<=47,e=(23===a||31===a)&&33<=b&&b<=35;if(!d&&!e)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,o.log("DEBUG","Repeated command ("+p([a,b])+") is dropped"),!0;c=20===a||23===a?1:2;var f=this.channels[c-1];return 20===a||28===a?32===b?f.ccRCL():33===b?f.ccBS():34===b?f.ccAOF():35===b?f.ccAON():36===b?f.ccDER():37===b?f.ccRU(2):38===b?f.ccRU(3):39===b?f.ccRU(4):40===b?f.ccFON():41===b?f.ccRDC():42===b?f.ccTR():43===b?f.ccRTD():44===b?f.ccEDM():45===b?f.ccCR():46===b?f.ccENM():47===b&&f.ccEOC():f.ccTO(b-32),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0}},{key:"parseMidrow",value:function(a,b){var c=null;if((17===a||25===a)&&32<=b&&b<=47){if(c=17===a?1:2,c!==this.currChNr)return o.log("ERROR","Mismatch channel in midrow parsing"),!1;var d=this.channels[c-1];return d.ccMIDROW(b),o.log("DEBUG","MIDROW ("+p([a,b])+")"),!0}return!1}},{key:"parsePAC",value:function(a,b){var c=null,d=null,e=(17<=a&&a<=23||25<=a&&a<=31)&&64<=b&&b<=127,f=(16===a||24===a)&&64<=b&&b<=95;if(!e&&!f)return!1;if(a===this.lastCmdA&&b===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;c=a<=23?1:2,d=64<=b&&b<=95?1===c?j[a]:l[a]:1===c?k[a]:m[a];var g=this.interpretPAC(d,b),h=this.channels[c-1];return h.setPAC(g),this.lastCmdA=a,this.lastCmdB=b,this.currChNr=c,!0}},{key:"interpretPAC",value:function(a,b){var c=b,d={color:null,italics:!1,indent:null,underline:!1,row:a};return c=b>95?b-96:b-64,d.underline=1===(1&c),c<=13?d.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:c<=15?(d.italics=!0,d.color="white"):d.indent=4*Math.floor((c-16)/2),d}},{key:"parseChars",value:function(a,b){var c=null,d=null,e=null;if(a>=25?(c=2,e=a-8):(c=1,e=a),17<=e&&e<=19){var f=b;f=17===e?b+80:18===e?b+112:b+144,o.log("INFO","Special char '"+g(f)+"' in channel "+c),d=[f]}else 32<=a&&a<=127&&(d=0===b?[a]:[a,b]);if(d){var h=p(d);o.log("DEBUG","Char codes =  "+h.join(",")),this.lastCmdA=null,this.lastCmdB=null}return d}},{key:"parseBackgroundAttributes",value:function(a,b){var c,d,e,f,g=(16===a||24===a)&&32<=b&&b<=47,h=(23===a||31===a)&&45<=b&&b<=47;return!(!g&&!h)&&(c={},16===a||24===a?(d=Math.floor((b-32)/2),c.background=n[d],b%2===1&&(c.background=c.background+"_semi")):45===b?c.background="transparent":(c.foreground="black",47===b&&(c.underline=!0)),e=a<24?1:2,f=this.channels[e-1],f.setBkgData(c),this.lastCmdA=null,this.lastCmdB=null,!0)}},{key:"reset",value:function(){for(var a=0;a<this.channels.length;a++)this.channels[a]&&this.channels[a].reset();this.lastCmdA=null,this.lastCmdB=null}},{key:"cueSplitAtTime",value:function(a){for(var b=0;b<this.channels.length;b++)this.channels[b]&&this.channels[b].cueSplitAtTime(a)}}]),a}();c["default"]=v},{}],43:[function(a,b,c){"use strict";var d={newCue:function(a,b,c,d){for(var e,f,g,h,i,j=window.VTTCue||window.TextTrackCue,k=0;k<d.rows.length;k++)if(e=d.rows[k],g=!0,h=0,i="",!e.isEmpty()){for(var l=0;l<e.chars.length;l++)e.chars[l].uchar.match(/\s/)&&g?h++:(i+=e.chars[l].uchar,g=!1);e.cueStartTime=b,f=new j(b,c,i.trim()),h>=16?h--:h++,navigator.userAgent.match(/Firefox\//)?f.line=k+1:f.line=k>7?k-2:k+1,f.align="left",f.position=Math.max(0,Math.min(100,100*(h/32)+(navigator.userAgent.match(/Firefox\//)?50:0))),a.addCue(f)}}};b.exports=d},{}],44:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){d(this,a),this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=0,this.totalWeight_=0}return e(a,[{key:"sample",value:function(a,b){var c=Math.pow(this.alpha_,a);this.estimate_=b*(1-c)+c*this.estimate_,this.totalWeight_+=a}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var a=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/a}return this.estimate_}}]),a}();c["default"]=f},{}],45:[function(a,b,c){"use strict";function d(){}function e(a,b){return b="["+a+"] > "+b}function f(a){var b=self.console[a];return b?function(){for(var c=arguments.length,d=Array(c),f=0;f<c;f++)d[f]=arguments[f];d[0]&&(d[0]=e(a,d[0])),b.apply(self.console,d)}:d}function g(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];c.forEach(function(b){j[b]=a[b]?a[b].bind(a):f(b)})}Object.defineProperty(c,"__esModule",{value:!0});var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},i={trace:d,debug:d,log:d,warn:d,info:d,error:d},j=i;c.enableLogs=function(a){if(a===!0||"object"===("undefined"==typeof a?"undefined":h(a))){g(a,"debug","log","info","warn","error");try{j.log()}catch(b){j=i}}else j=i},c.logger=j},{}],46:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a)}return e(a,null,[{key:"toString",value:function(a){for(var b="",c=a.length,d=0;d<c;d++)b+="["+a.start(d).toFixed(3)+","+a.end(d).toFixed(3)+"]";return b}}]),a}();c["default"]=f},{}],47:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a(45),g=function(){function a(b){d(this,a),b&&b.xhrSetup&&(this.xhrSetup=b.xhrSetup)}return e(a,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var a=this.loader;a&&4!==a.readyState&&(this.stats.aborted=!0,a.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function(a,b,c){this.context=a,this.config=b,this.callbacks=c,this.stats={trequest:performance.now(),retry:0},this.retryDelay=b.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function(){var a,b=this.context;a="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,a.onreadystatechange=this.readystatechange.bind(this),a.onprogress=this.loadprogress.bind(this),a.open("GET",b.url,!0),b.rangeEnd&&a.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),a.responseType=b.responseType;var c=this.stats;c.tfirst=0,c.loaded=0,this.xhrSetup&&this.xhrSetup(a,b.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),a.send()}},{key:"readystatechange",value:function(a){var b=a.currentTarget,c=b.readyState,d=this.stats,e=this.context,g=this.config;if(!d.aborted&&c>=2)if(window.clearTimeout(this.requestTimeout),0===d.tfirst&&(d.tfirst=Math.max(performance.now(),d.trequest)),4===c){var h=b.status;if(h>=200&&h<300){d.tload=Math.max(d.tfirst,performance.now());var i=void 0,j=void 0;"arraybuffer"===e.responseType?(i=b.response,j=i.byteLength):(i=b.responseText,j=i.length),d.loaded=d.total=j;var k={url:b.responseURL,data:i};this.callbacks.onSuccess(k,d,e)}else d.retry>=g.maxRetry||h>=400&&h<499?(f.logger.error(h+" while loading "+e.url),this.callbacks.onError({code:h,text:b.statusText},e)):(f.logger.warn(h+" while loading "+e.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,g.maxRetryDelay),d.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),g.timeout)}},{key:"loadtimeout",value:function(){f.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context)}},{key:"loadprogress",value:function(a){var b=this.stats;b.loaded=a.loaded,a.lengthComputable&&(b.total=a.total);var c=this.callbacks.onProgress;c&&c(b,this.context,null)}}]),a}();c["default"]=g},{45:45}]},{},[33])(33)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],4:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function k(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){var e=Object.getPrototypeOf(a);return null===e?void 0:k(e,b,c)}if("value"in d)return d.value;var f=d.get;if(void 0!==f)return f.call(c)},i=videojs.getComponent("MenuItem"),j=function(a){function b(){return d(this,b),e(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return f(b,a),g(b,[{key:"handleClick",value:function(){h(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"handleClick",this).call(this),this.options_.qualitySwitchCallback(this.options_.id,this.options_.trackType)}}]),b}(i);c["default"]=j},{}],5:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function k(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){var e=Object.getPrototypeOf(a);return null===e?void 0:k(e,b,c)}if("value"in d)return d.value;var f=d.get;if(void 0!==f)return f.call(c)},i=videojs.getComponent("Menu"),j=function(a){function b(){return d(this,b),e(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return f(b,a),g(b,[{key:"addItem",value:function(a){var c=this;h(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"addItem",this).call(this,a),a.on("click",function(){for(var b=c.children(),d=0;d<b.length;d++){var e=b[d];a!==e&&e.selected(!1)}})}}]),b}(i);c["default"]=j},{}],6:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var h=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},i=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),j=a("./quality-menu"),k=d(j),l=a("./quality-menu-item"),m=d(l),n=videojs.getComponent("MenuButton"),o=function(a){function b(){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return g(b,a),i(b,[{key:"createMenu",value:function(){for(var a,b,c=new k["default"](this.player,this.options_),d=0;d<this.options_.qualityList.length;d++){var e=this.options_.qualityList[d],f=this.options_,g=f.qualitySwitchCallback,i=f.trackType;b=h({qualitySwitchCallback:g,trackType:i},e,{selectable:!0}),a=new m["default"](this.player,b),c.addItem(a)}return c}}]),b}(n);c["default"]=o},{"./quality-menu":5,"./quality-menu-item":4}],7:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){function b(a,b){var d=b.qualityData,h=b.qualitySwitchCallback,i=c.controlBar.getChild("fullscreenToggle");c.controlBar.removeChild(i);for(var j=0;j<e.length;j++){var k=e[j],l=k+"PickerButton",m=c.controlBar.getChild(l);m&&(m.dispose(),c.controlBar.removeChild(m)),d[k]&&d[k].length>1&&(m=new g["default"](c,{name:l,qualityList:d[k],qualitySwitchCallback:h,trackType:k}),m.addClass(f[k]),c.controlBar.addChild(m))}i&&c.controlBar.addChild(i)}var c=this,d=this.tech_,e=["video","audio","subtitle"],f={video:"vjs-icon-hd",audio:"vjs-icon-cog",subtitle:"vjs-icon-subtitles"};d.on("loadedqualitydata",b)}var f=a("./quality-picker-button"),g=d(f);videojs.plugin("qualityPickerPlugin",e)},{"./quality-picker-button":6}]},{},[1]);